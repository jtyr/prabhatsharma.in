(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"1O5Y":function(l,e,t){"use strict";var n=t("Mlb/"),i=t("jmHW"),u=t("pk7F"),s=t("Ienz"),a=t("P6pJ"),r=t("vk2e"),o=t("dPh1"),c=t("yi+q"),b=t("X/tG"),d=t("aWYc"),h=t("nkAL"),g=t("Jt2c"),m=t("5EQ0"),p=t("ba/H"),f=t("Myyq"),S=t("F5Xg"),v=t("EYJY"),I=t("O6Zd"),y=t("ccoi"),k=t("Rtcc");class C{constructor(l,e){this.searchStateService=l,this.searchResultService=e,this.onDestroy=new v.a}ngOnInit(){const l=this.searchStateService.getListModel();this.listId=l.id,this.collectionId=this.searchStateService.getActiveSearch().collectionId,this.initialEntityIdsInList$=this.searchResultService.getFullSearchResults([k.a.Fields.identifier],k.a.Collections.identifiers).pipe(Object(I.a)(l=>l.data.entities.map(l=>l.properties.identifier.uuid))),this.searchStateService.getActiveSearchObservable().pipe(Object(y.a)(this.onDestroy)).subscribe(l=>this.collectionId=l.collectionId)}ngOnDestroy(){this.onDestroy.next()}refreshResults(){this.searchResultService.search(null,!0)}clearInput(){this.quickAdd.clearInput()}}var E=t("qFRT"),L=t("EwV0"),x=n.sb({encapsulation:0,styles:[[""]],data:{}});function P(l){return n.Qb(0,[n.Mb(671088640,1,{quickAdd:0}),(l()(),n.ub(1,0,null,null,2,"quick-add",[["appearance","narrow"],["class","flex flex-gt-xs-none cb-margin-medium-left"]],null,[[null,"itemAdded"],[null,"itemRemoved"]],function(l,e,t){var n=!0,i=l.component;return"itemAdded"===e&&(n=!1!==i.refreshResults()&&n),"itemRemoved"===e&&(n=!1!==i.refreshResults()&&n),n},o.b,o.a)),n.tb(2,770048,[[1,4]],0,c.a,[b.a,d.b,h.a,g.a,m.a,p.a,f.a,S.a],{listId:[0,"listId"],collectionId:[1,"collectionId"],initialEntityIdsInList:[2,"initialEntityIdsInList"],appearance:[3,"appearance"]},{itemAdded:"itemAdded",itemRemoved:"itemRemoved"}),n.Ib(131072,r.b,[n.h])],function(l,e){var t=e.component;l(e,2,0,t.listId,t.collectionId,n.Pb(e,2,2,n.Gb(e,3).transform(t.initialEntityIdsInList$)),"narrow")},null)}var w=t("Uy3s"),G=t("soOm"),R=t("GKMj"),A=t("sl8x"),T=t("0KxO"),O=t("Wrdk"),_=t("qpUv"),F=t("k6lf"),M=t("ivOl"),N=t("m6lo"),B=t("qk26"),D=t("9b0e"),U=t("6YJn"),H=t("Htug"),z=t("nJV+"),Q=t("EjzE"),$=t("QBrs"),j=t("BRL0"),K=t("9va6");class V{constructor(l,e){this.drillInService=l,this.logService=e,this.links=[]}ngOnInit(){this.logger=this.logService.getLogger("DrillInMenuComponent"),this.loaded=!1,this.errored=!1,this.identifierUuid=this.getIdentifierUuid(this.identifierFieldData),this.canLoadIdentifierLinks=this.drillInService.canLoadIdentifierLinks()}openMenu(){this.loaded||this.loadIdentifierLinks(this.identifierUuid)}getIdentifierUuid(l){if(!Object(K.isEmpty)(l)){let e=l.uuid;if(e)return e;this.logger.error("Identifier field present but had no uuid",{identifier:l})}return null}loadIdentifierLinks(l){this.drillInService.getIdentifierLinks(l).then(l=>{this.links=l,this.loaded=!0},l=>this.handleDrillInError(l))}handleDrillInError(l){this.errored=!0,this.loaded=!1,this.logger.error("Error showing drill-in menu",l)}}var q=t("ue+9"),W=t("7k2d");let X=(()=>{class l{constructor(l,e,t,n,i){this.labelsService=l,this.metadataService=e,this.permissionService=t,this.searchStateService=n,this.searchApi=i}getIdentifierLinks(l){let{collectionId:e}=this.searchStateService.getSearchInfo(),t=this.getSubqueries(),n=[];return Object(K.forEach)(t,t=>{let i=t.toModel().query;i.push(this.getParentIdentifierPredicate(l));let u=this.metadataService.getRelationshipByCollectionId(e,t.relCollectionId),s=this.getCollectionFieldIds(u.collection_id);if(s.length>0){let l={query:i,limit:this.permissionService.getSearchResultLimit(),field_ids:s,order:[]},e=this.buildSlug(u.collection_id,l).then(l=>this.buildLink("CBL.SEARCH.DRILL_IN_IDENTIFIER",u.collection_id,l.data),l=>Promise.reject(l));n.push(e)}}),Promise.all(n)}canLoadIdentifierLinks(){let l=this.getSubqueries();return l.length>0&&this.hasDefaultColumns(l)}hasDefaultColumns(l){let e=!1;return Object(K.forEach)(l,l=>{if(this.getCollectionFieldIds(l.relCollectionId).length>0)return e=!0,!1}),e}buildLink(l,e,t){let n=this.metadataService.getEntityDef(e);return{label:this.labelsService.getInterpolatedLabel(l,{type:n.labels.plural}),route:["/search",e,t.slug]}}buildSlug(l,e){return this.searchApi.mdSearchesCollectionIdPost(l,void 0,e)}getParentIdentifierPredicate(l){return{type:q.G.TypeEnum.parent_predicate,operator_id:"eq",values:[l]}}getCollectionFieldIds(l){return this.metadataService.getDefaultColumns(l).map(l=>l.field_id)}getSubqueries(){let l=this.searchStateService.getSearchQueryItems();return Object(K.filter)(l,l=>l.getType()===q.G.TypeEnum.sub_query)}}return l.ngInjectableDef=n.Ub({factory:function(){return new l(n.Vb(p.a),n.Vb(h.a),n.Vb(A.a),n.Vb(E.a),n.Vb(W.a))},token:l,providedIn:"root"}),l})();var J=n.sb({encapsulation:2,styles:[],data:{}});function Y(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,5,null,null,null,null,null,null,null)),(l()(),n.ub(1,0,null,null,4,"a",[["class","drill-link layout-row layout-align-start-center mat-menu-item"],["mat-menu-item",""]],[[1,"aria-label",0],[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0],[1,"target",0],[8,"href",4]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0;return"click"===e&&(i=!1!==n.Gb(l,2)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,2)._handleMouseEnter()&&i),"click"===e&&(i=!1!==n.Gb(l,3).onClick(t.button,t.ctrlKey,t.metaKey,t.shiftKey)&&i),i},M.c,M.a)),n.tb(2,180224,[[1,4],[2,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),n.tb(3,671744,null,0,B.s,[B.p,B.a,r.l],{routerLink:[0,"routerLink"]},null),(l()(),n.ub(4,0,null,0,1,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(5,null,["",""]))],function(l,e){l(e,3,0,e.context.$implicit.route)},function(l,e){l(e,1,0,e.context.$implicit.label,n.Gb(e,2).role,n.Gb(e,2)._highlighted,n.Gb(e,2)._triggersSubmenu,n.Gb(e,2)._getTabIndex(),n.Gb(e,2).disabled.toString(),n.Gb(e,2).disabled||null,n.Gb(e,3).target,n.Gb(e,3).href),l(e,5,0,e.context.$implicit.label)})}function Z(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,"div",[],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,Y)),n.tb(2,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"]},null)],function(l,e){l(e,2,0,e.component.links)},null)}function ll(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,4,"button",[["class","mat-menu-item"],["mat-menu-item",""]],[[1,"aria-label",0],[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0;return"click"===e&&(i=!1!==n.Gb(l,1)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,1)._handleMouseEnter()&&i),i},M.c,M.a)),n.tb(1,180224,[[1,4],[2,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),n.Kb(2,1),(l()(),n.Ob(3,0,[" "," "])),n.Kb(4,1)],null,function(l,e){var t=n.Pb(e,0,0,l(e,2,0,n.Gb(e.parent.parent,0),"CBL.COMMON.OOPS"));l(e,0,0,t,n.Gb(e,1).role,n.Gb(e,1)._highlighted,n.Gb(e,1)._triggersSubmenu,n.Gb(e,1)._getTabIndex(),n.Gb(e,1).disabled.toString(),n.Gb(e,1).disabled||null);var i=n.Pb(e,3,0,l(e,4,0,n.Gb(e.parent.parent,0),"CBL.COMMON.OOPS"));l(e,3,0,i)})}function el(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,4,"button",[["class","mat-menu-item"],["mat-menu-item",""]],[[1,"aria-label",0],[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0;return"click"===e&&(i=!1!==n.Gb(l,1)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,1)._handleMouseEnter()&&i),i},M.c,M.a)),n.tb(1,180224,[[1,4],[2,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),n.Kb(2,1),(l()(),n.Ob(3,0,[" "," "])),n.Kb(4,1)],null,function(l,e){var t=n.Pb(e,0,0,l(e,2,0,n.Gb(e.parent.parent,0),"CBL.COMMON.LOADING"));l(e,0,0,t,n.Gb(e,1).role,n.Gb(e,1)._highlighted,n.Gb(e,1)._triggersSubmenu,n.Gb(e,1)._getTabIndex(),n.Gb(e,1).disabled.toString(),n.Gb(e,1).disabled||null);var i=n.Pb(e,3,0,l(e,4,0,n.Gb(e.parent.parent,0),"CBL.COMMON.LOADING"));l(e,3,0,i)})}function tl(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,25,"div",[["class","component--drill-in-menu"]],null,null,null,null,null)),(l()(),n.ub(1,16777216,null,null,4,"a",[["aria-haspopup","true"],["class","cb-link mat-menu-trigger"]],[[1,"aria-label",0],[1,"aria-expanded",0]],[[null,"click"],[null,"mousedown"],[null,"keydown"]],function(l,e,t){var i=!0,u=l.component;return"mousedown"===e&&(i=!1!==n.Gb(l,2)._handleMousedown(t)&&i),"keydown"===e&&(i=!1!==n.Gb(l,2)._handleKeydown(t)&&i),"click"===e&&(i=!1!==n.Gb(l,2)._handleClick(t)&&i),"click"===e&&(i=!1!==u.openMenu()&&i),i},null,null)),n.tb(2,1196032,null,0,N.h,[D.c,n.k,n.P,N.c,[2,N.d],[8,null],[2,U.b],s.f],{menu:[0,"menu"]},null),n.Kb(3,1),(l()(),n.ub(4,0,null,null,1,"icon",[["class","search"],["color","inherit"],["key","search-menu"],["size","large"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(5,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],color:[1,"color"],size:[2,"size"],class:[3,"class"]},null),(l()(),n.ub(6,0,null,null,19,"mat-menu",[],null,null,null,M.d,M.b)),n.tb(7,1294336,[["drillInMenu",4]],3,N.i,[n.k,n.y,N.a],{overlapTrigger:[0,"overlapTrigger"]},null),n.Mb(603979776,1,{_allItems:1}),n.Mb(603979776,2,{items:1}),n.Mb(603979776,3,{lazyContent:0}),n.Lb(2048,null,N.d,null,[N.i]),n.Lb(2048,null,N.b,null,[N.d]),(l()(),n.ub(13,0,null,0,4,"button",[["class","mat-menu-item"],["mat-menu-item",""]],[[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0;return"click"===e&&(i=!1!==n.Gb(l,14)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,14)._handleMouseEnter()&&i),i},M.c,M.a)),n.tb(14,180224,[[1,4],[2,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),(l()(),n.ub(15,0,null,0,2,"span",[],null,null,null,null,null)),(l()(),n.Ob(16,null,["",""])),n.Kb(17,1),(l()(),n.ub(18,0,null,0,1,"mat-divider",[["class","mat-divider"],["role","separator"]],[[1,"aria-orientation",0],[2,"mat-divider-vertical",null],[2,"mat-divider-horizontal",null],[2,"mat-divider-inset",null]],null,null,Q.b,Q.a)),n.tb(19,49152,null,0,$.a,[],null,null),(l()(),n.kb(16777216,null,0,1,null,Z)),n.tb(21,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,0,1,null,ll)),n.tb(23,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,0,1,null,el)),n.tb(25,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component;l(e,2,0,n.Gb(e,7)),l(e,5,0,"search-menu","inherit","large","search"),l(e,7,0,!1),l(e,21,0,t.loaded),l(e,23,0,t.errored),l(e,25,0,!t.loaded&&!t.errored)},function(l,e){var t=n.Pb(e,1,0,l(e,3,0,n.Gb(e.parent,0),"CBL.SEARCH.DRILL_IN"));l(e,1,0,t,n.Gb(e,2).menuOpen||null),l(e,4,0,n.Gb(e,5).classes),l(e,13,0,n.Gb(e,14).role,n.Gb(e,14)._highlighted,n.Gb(e,14)._triggersSubmenu,n.Gb(e,14)._getTabIndex(),n.Gb(e,14).disabled.toString(),n.Gb(e,14).disabled||null);var i=n.Pb(e,16,0,l(e,17,0,n.Gb(e.parent,0),"CBL.SEARCH.SHOW_MATCHING"));l(e,16,0,i),l(e,18,0,n.Gb(e,19).vertical?"vertical":"horizontal",n.Gb(e,19).vertical,!n.Gb(e,19).vertical,n.Gb(e,19).inset)})}function nl(l){return n.Qb(0,[n.Ib(0,j.a,[p.a]),(l()(),n.kb(16777216,null,null,1,null,tl)),n.tb(2,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component;l(e,2,0,t.identifierUuid&&t.canLoadIdentifierLinks)},null)}var il=t("y6+A"),ul=t("NFli"),sl=t("IGbz"),al=t("ryMw"),rl=t("/T1k"),ol=t("ykfZ"),cl=t("J85h"),bl=t("wqFj"),dl=t("3iBx"),hl=t("4EDN"),gl=t("ZFGm"),ml=t("8aWl");let pl=(()=>{class l{constructor(l,e,t,n,i){this.labelsService=l,this.searchStateService=e,this.aggregateService=t,this.metadataService=n,this.fieldFormatterService=i}ngOnChanges(l){(l.resultsHeaders||l.fieldAggregates||l.search)&&this.updateAggregates()}isAggregateSelected(l,e){return"value_card"===l.type?e:l.type===this.selectedAggregateType}shouldShowAggregatesMenu(){let l=this.isValueCard(this.getSelectedAggregateType());return!l||l&&this.resultStats.totalCount>0}selectAggregate(l){if(this.selectedAggregateType=l.type,this.isValueCard(l.type)){let e=Object(K.findIndex)(this.formattedAggregates,l);e>-1&&this.formattedAggregates.splice(0,0,this.formattedAggregates.splice(e,1)[0])}else this.searchStateService.setSelectedFieldAggregateId(this.fieldId,l.type)}updateAggregates(){this.selectedAggregateType=this.getSelectedAggregateType(),this.formattedAggregates=this.getFormattedAggregates()}getSelectedAggregateType(){let{collectionId:l}=this.searchStateService.getSearchInfo(),e=this.searchStateService.getSelectedFieldAggregateId(this.fieldId),t=this.aggregateService.getDefaultFieldAggregateId(l,this.fieldId);return e||t}getFormattedAggregates(){let l=[];return Object(K.forEach)(this.fieldAggregates,(e,t)=>{this.hasSubAggregates(t)?this.isPercentiles(t)?Object(K.forEach)(e,(e,n)=>{l.push({type:t,subType:n,label:this.getSubAggregateLabel(t,n),value:this.formatAggregate(e)})}):this.isValueCard(t)&&(l=this.getFormattedValueCardAggregates(t,e)):l.push({type:t,label:this.getAggregateLabel(t),value:this.formatAggregate(e)})}),l}getFormattedValueCardAggregates(e,t){let{collectionId:n}=this.searchStateService.getSearchInfo(),i=[],u=this.resultStats.totalCount,s=this.getValueCardTotal(t),a=Object(K.keys)(t),r=Object(K.min)([a.length,l.MAX_VALUE_CARD_OPTIONS]),o=0,c=this.metadataService.getField(n,this.fieldId).type_id,b="enum_multi"!==c,d="enum_multi"!==c;for(let l=0;l<a.length;l++){let n=a[l],s=t[n];if(l<r){let l=this.getSubAggregateLabel(e,n),t=this.getFormattedPercent(s,u);l&&t&&i.push({type:e,subType:n,label:l,value:t})}else o+=s}if(b&&o>0&&i.push({type:e,label:this.labelsService.getLabel("CBL.SEARCH.STATISTICS.OTHERS"),value:this.getFormattedPercent(o,u)}),d&&s<u){let l=u-s;i.push({type:e,label:this.labelsService.getLabel("CBL.SEARCH.STATISTICS.EMPTY"),value:this.getFormattedPercent(l,u)})}return i}getFormattedPercent(l,e){return e>0?Object(K.round)(l/e*100,1)+"%":"0%"}getValueCardTotal(l){let e=0;return Object(K.forEach)(l,(l,t)=>{e+=l}),e}isValueCard(l){return"value_card"===l}isPercentiles(l){return"percentiles"===l}hasSubAggregates(l){return this.isPercentiles(l)||this.isValueCard(l)}formatAggregate(l){let{collectionId:e}=this.searchStateService.getSearchInfo(),t=this.metadataService.getField(e,this.fieldId);return this.fieldFormatterService.formatAggregate(t,l,ml.a.default)}getAggregateLabel(l){let e="CBL.SEARCH.STATISTICS."+Object(K.toUpper)(l);return this.labelsService.getLabel(e)}getSubAggregateLabel(l,e){let t;return this.isPercentiles(l)?t=this.getPercentileAggregateLabel(e):this.isValueCard(l)&&(t=this.getEnumAggregateLabel(e)),t||null}getPercentileAggregateLabel(l){let e="CBL.SEARCH.STATISTICS.PERCENTILES."+Object(K.toString)(Object(K.toInteger)(l));return this.labelsService.getLabel(e)}getEnumAggregateLabel(l){let{collectionId:e}=this.searchStateService.getSearchInfo(),t=this.metadataService.getField(e,this.fieldId),n=t&&t.labels&&t.labels.values;return n&&l&&n[l]?n[l]:null}}return l.MAX_VALUE_CARD_OPTIONS=4,l})();var fl=t("mEy4"),Sl=n.sb({encapsulation:2,styles:[],data:{}});function vl(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,4,"span",[["class","cb-padding-medium-right aggregate-contents flex layout-column layout-align-center-end"]],null,null,null,null,null)),(l()(),n.ub(1,0,null,null,1,"span",[["class","cb-text-transform-none"]],null,null,null,null,null)),(l()(),n.Ob(2,null,["",""])),(l()(),n.ub(3,0,null,null,1,"span",[["class","cb-text-transform-none cb-font-weight-bold cb-font-size-medium"]],null,null,null,null,null)),(l()(),n.Ob(4,null,[" "," "]))],null,function(l,e){l(e,2,0,e.parent.context.$implicit.label),l(e,4,0,e.parent.context.$implicit.value)})}function Il(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,vl)),n.tb(2,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(0,null,null,0))],function(l,e){l(e,2,0,e.component.isAggregateSelected(e.context.$implicit,e.context.first))},null)}function yl(l){return n.Qb(0,[(l()(),n.ub(0,16777216,null,null,8,"button",[["aria-haspopup","true"],["class","cb-border-radius-none selected-aggregate flex layout-column layout-align-center-stretch layout-fill mat-menu-trigger"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null],[1,"aria-expanded",0]],[[null,"mousedown"],[null,"keydown"],[null,"click"]],function(l,e,t){var i=!0;return"mousedown"===e&&(i=!1!==n.Gb(l,2)._handleMousedown(t)&&i),"keydown"===e&&(i=!1!==n.Gb(l,2)._handleKeydown(t)&&i),"click"===e&&(i=!1!==n.Gb(l,2)._handleClick(t)&&i),i},i.d,i.b)),n.tb(1,180224,null,0,u.b,[n.k,s.f,[2,a.a]],null,null),n.tb(2,1196032,null,0,N.h,[D.c,n.k,n.P,N.c,[2,N.d],[8,null],[2,U.b],s.f],{menu:[0,"menu"]},null),(l()(),n.ub(3,0,null,0,5,"span",[["class","flex layout-row"]],null,null,null,null,null)),(l()(),n.ub(4,0,null,null,2,"div",[["class","cb-background-accent layout-column layout-align-center-center"]],null,null,null,null,null)),(l()(),n.ub(5,0,null,null,1,"icon",[["class","flex-none"],["color","light"],["key","chevron-up"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(6,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],color:[1,"color"],class:[2,"class"]},null),(l()(),n.kb(16777216,null,null,1,null,Il)),n.tb(8,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"]},null),(l()(),n.kb(0,null,null,0))],function(l,e){var t=e.component;l(e,2,0,n.Gb(e.parent,6)),l(e,6,0,"chevron-up","light","flex-none"),l(e,8,0,t.formattedAggregates)},function(l,e){l(e,0,0,"CBL.SEARCH.STATISTICS.OPEN_SHEET",n.Gb(e,1).disabled||null,"NoopAnimations"===n.Gb(e,1)._animationMode,n.Gb(e,2).menuOpen||null),l(e,5,0,n.Gb(e,6).classes)})}function kl(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,12,"div",[],null,null,null,null,null)),(l()(),n.ub(1,0,null,null,11,"button",[["class","mat-menu-item"],["mat-menu-item",""],["type","button"]],[[1,"aria-label",0],[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0,u=l.component;return"click"===e&&(i=!1!==n.Gb(l,2)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,2)._handleMouseEnter()&&i),"click"===e&&(i=!1!==u.selectAggregate(l.context.$implicit)&&i),i},M.c,M.a)),n.tb(2,180224,[[1,4],[2,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),(l()(),n.ub(3,0,null,0,9,"span",[["class","layout-row layout-align-space-between-center"]],null,null,null,null,null)),(l()(),n.ub(4,0,null,null,3,"icon",[["class","cb-padding-none cb-margin-none flex-none"],["color","accent"],["key","check"]],[[8,"className",0]],null,null,H.b,H.a)),n.Lb(512,null,r.F,r.G,[n.r,n.s,n.k,n.D]),n.tb(6,278528,null,0,r.n,[r.F],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),n.tb(7,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],color:[1,"color"],class:[2,"class"]},null),(l()(),n.ub(8,0,null,null,4,"span",[["class","cb-padding-right-medium aggregate-contents flex-none layout-column layout-align-center-end"]],null,null,null,null,null)),(l()(),n.ub(9,0,null,null,1,"span",[["class","cb-text-transform-none"]],null,null,null,null,null)),(l()(),n.Ob(10,null,["",""])),(l()(),n.ub(11,0,null,null,1,"span",[["class","cb-text-transform-none cb-font-weight-bold cb-font-size-medium"]],null,null,null,null,null)),(l()(),n.Ob(12,null,[" "," "]))],function(l,e){l(e,6,0,"cb-padding-none cb-margin-none flex-none",e.component.isAggregateSelected(e.context.$implicit,e.context.first)?"cb-visible":"cb-hidden"),l(e,7,0,"check","accent","cb-padding-none cb-margin-none flex-none")},function(l,e){l(e,1,0,e.context.$implicit.label,n.Gb(e,2).role,n.Gb(e,2)._highlighted,n.Gb(e,2)._triggersSubmenu,n.Gb(e,2)._getTabIndex(),n.Gb(e,2).disabled.toString(),n.Gb(e,2).disabled||null),l(e,4,0,n.Gb(e,7).classes),l(e,10,0,e.context.$implicit.label),l(e,12,0,e.context.$implicit.value)})}function Cl(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,11,"div",[["class","component--aggregates layout-column layout-fill"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,yl)),n.tb(2,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.ub(3,0,null,null,8,"mat-menu",[["class","component--aggregates aggregate-sheet"]],null,null,null,M.d,M.b)),n.Lb(6144,null,N.d,null,[N.i]),n.Lb(6144,null,N.b,null,[N.d]),n.tb(6,1294336,[["aggregatesMenu",4]],3,N.i,[n.k,n.y,N.a],{overlapTrigger:[0,"overlapTrigger"],panelClass:[1,"panelClass"]},null),n.Mb(603979776,1,{_allItems:1}),n.Mb(603979776,2,{items:1}),n.Mb(603979776,3,{lazyContent:0}),(l()(),n.kb(16777216,null,0,1,null,kl)),n.tb(11,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"]},null)],function(l,e){var t=e.component;l(e,2,0,t.shouldShowAggregatesMenu()),l(e,6,0,!1,"component--aggregates aggregate-sheet"),l(e,11,0,t.formattedAggregates)},null)}class El{getElementRef(){return this.footer}}var Ll=n.sb({encapsulation:2,styles:[],data:{}});function xl(l){return n.Qb(2,[n.Mb(402653184,1,{footer:0}),(l()(),n.ub(1,0,[[1,0],["footer",1]],null,1,"div",[["class","component--grid-footer"]],null,null,null,null,null)),n.Fb(null,0)],null,null)}var Pl=t("BVFw"),wl=t("AJGL"),Gl=t("pees"),Rl=t("xJk/"),Al=t("DJAz"),Tl=t("62RF"),Ol=t("szI2"),_l=t("cwgC"),Fl=t("iRHA"),Ml=t("lzeM"),Nl=t("oc/z"),Bl=t("lgVn");class Dl{constructor(l,e,t,n,i,u){this.localeNumberPipe=l,this.labelService=e,this.util=t,this.searchResultService=n,this.searchStateService=i,this.permService=u,this.canPageBack=!1,this.canPageForward=!1,this.showPageControls=!1,this.prevPageQueryParams={},this.nextPageQueryParams={},this.searchInProgressSubcription=this.searchResultService.getSearchInProgressObservable().subscribe(l=>{this.searchInProgress=l})}ngOnChanges(l){this.setup()}ngOnDestroy(){this.searchInProgressSubcription&&this.searchInProgressSubcription.unsubscribe()}setup(){let l=this.results,e=this.searchResultService.parsePageId(this.pageId);if(this.hasResults(l)){let{totalCount:t}=l.stats,{executionTimeLabel:n,resultCountLabel:i}=l.labels,{rangeLabel:u,resultLabel:s}=this.getSearchResultLabels(t,e.page,this.pageSize,i);this.rangeLabel=u,this.resultLabel=s,this.executionTimeLabel=n;let a=this.searchStateService.getListModel(),r=this.permService.getDisplaySearchResultLimit(a);this.prevPageQueryParams=this.getPrevPageQueryParams(),this.nextPageQueryParams=this.getNextPageQueryParams();let{showPageControls:o,canPageBack:c,canPageForward:b}=this.getPaginationSettings(e.page,this.pageSize,Math.min(r,t));this.showPageControls=o,this.canPageBack=c,this.canPageForward=b}}getPaginationSettings(l,e,t){let n=l>1,i=l<Object(K.ceil)(t/e);return{showPageControls:n||i,canPageBack:n,canPageForward:i}}getLastPageNumber(){let l=this.searchStateService.getListModel();return this.permService.getDisplaySearchResultLimit(l)/this.pageSize}getPrevPageQueryParams(){let l=Object(K.first)(this.results.entities),e=this.searchResultService.parsePageId(this.pageId);return e.page<=2||!l?{}:{pageId:this.searchResultService.getPageId(e.page-1,!1,l.properties.identifier.uuid)}}getNextPageQueryParams(){let l=Object(K.last)(this.results.entities),e=this.searchResultService.parsePageId(this.pageId);return e.page!==this.getLastPageNumber()&&l?{pageId:this.searchResultService.getPageId(e.page+1,!0,l.properties.identifier.uuid)}:{}}getSearchResultLabels(l,e,t,n){let i=null,u=null;if(!this.util.isUndefinedOrNull(l)&&!this.isForbiddenSearch()){const s=l<=t;1===l||s||(i=this.getRangeLabel(e,t,l)),u=n}return{rangeLabel:i,resultLabel:u}}isForbiddenSearch(){const l=this.searchResultService.getSearchError();return l&&l.code===Bl.u.CodeEnum.MD403}getRangeLabel(l,e,t){let n=(l-1)*e,i=n+e;return t<i&&(i=t),this.labelService.getInterpolatedLabel("CBL.SEARCH.RESULTS_RANGE",{start:this.localeNumberPipe.transform(n+=1),end:this.localeNumberPipe.transform(i)})}hasResults(l){return!Object(K.isEmpty)(l)&&Object(K.has)(l,"stats")&&Object(K.has)(l,"labels")&&Object(K.has)(l,"entities")&&Object(K.isArray)(l.entities)}}var Ul=t("omos"),Hl=n.sb({encapsulation:2,styles:[],data:{}});function zl(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,13,"a",[["class","page-button-prev"],["color","primary"],["mat-button",""]],[[1,"aria-label",0],[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0],[2,"_mat-animation-noopable",null],[1,"target",0],[8,"href",4]],[[null,"click"]],function(l,e,t){var i=!0;return"click"===e&&(i=!1!==n.Gb(l,4)._haltDisabledEvents(t)&&i),"click"===e&&(i=!1!==n.Gb(l,5).onClick(t.button,t.ctrlKey,t.metaKey,t.shiftKey)&&i),i},i.c,i.a)),n.Lb(512,null,r.F,r.G,[n.r,n.s,n.k,n.D]),n.tb(2,278528,null,0,r.n,[r.F],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),n.Jb(3,{"cb-link-noevents":0}),n.tb(4,180224,null,0,u.a,[s.f,n.k,[2,a.a]],{disabled:[0,"disabled"],color:[1,"color"]},null),n.tb(5,671744,null,0,B.s,[B.p,B.a,r.l],{queryParams:[0,"queryParams"],routerLink:[1,"routerLink"]},null),n.Hb(6,1),n.Kb(7,1),(l()(),n.ub(8,0,null,0,5,"div",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(9,0,null,null,1,"icon",[["class","flex-none"],["color","inherit"],["key","chevron-left"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(10,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],color:[1,"color"],class:[2,"class"]},null),(l()(),n.ub(11,0,null,null,2,"span",[["class","flex-noshrink"]],null,null,null,null,null)),(l()(),n.Ob(12,null,["",""])),n.Kb(13,1)],function(l,e){var t=e.component,n=l(e,3,0,!t.canPageBack||t.searchInProgress);l(e,2,0,"page-button-prev",n),l(e,4,0,!t.canPageBack||t.searchInProgress,"primary");var i=t.prevPageQueryParams,u=l(e,6,0,"./");l(e,5,0,i,u),l(e,10,0,"chevron-left","inherit","flex-none")},function(l,e){var t=n.Pb(e,0,0,l(e,7,0,n.Gb(e.parent,0),"CBL.SEARCH.RESULTS_PREVIOUS"));l(e,0,0,t,n.Gb(e,4).disabled?-1:n.Gb(e,4).tabIndex||0,n.Gb(e,4).disabled||null,n.Gb(e,4).disabled.toString(),"NoopAnimations"===n.Gb(e,4)._animationMode,n.Gb(e,5).target,n.Gb(e,5).href),l(e,9,0,n.Gb(e,10).classes);var i=n.Pb(e,12,0,l(e,13,0,n.Gb(e.parent,0),"CBL.SEARCH.RESULTS_PREVIOUS"));l(e,12,0,i)})}function Ql(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,13,"a",[["class","page-button-next"],["color","primary"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0],[2,"_mat-animation-noopable",null],[1,"target",0],[8,"href",4]],[[null,"click"]],function(l,e,t){var i=!0;return"click"===e&&(i=!1!==n.Gb(l,4)._haltDisabledEvents(t)&&i),"click"===e&&(i=!1!==n.Gb(l,5).onClick(t.button,t.ctrlKey,t.metaKey,t.shiftKey)&&i),i},i.c,i.a)),n.Lb(512,null,r.F,r.G,[n.r,n.s,n.k,n.D]),n.tb(2,278528,null,0,r.n,[r.F],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),n.Jb(3,{"cb-link-noevents":0}),n.tb(4,180224,null,0,u.a,[s.f,n.k,[2,a.a]],{disabled:[0,"disabled"],color:[1,"color"]},null),n.tb(5,671744,null,0,B.s,[B.p,B.a,r.l],{queryParams:[0,"queryParams"],routerLink:[1,"routerLink"]},null),n.Hb(6,1),n.Kb(7,1),(l()(),n.ub(8,0,null,0,5,"div",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(9,0,null,null,2,"span",[["class","flex-noshrink"]],null,null,null,null,null)),(l()(),n.Ob(10,null,["",""])),n.Kb(11,1),(l()(),n.ub(12,0,null,null,1,"icon",[["class","flex-none"],["color","inherit"],["key","chevron-right"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(13,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],color:[1,"color"],class:[2,"class"]},null)],function(l,e){var t=e.component,n=l(e,3,0,!t.canPageForward||t.searchInProgress);l(e,2,0,"page-button-next",n),l(e,4,0,!t.canPageForward||t.searchInProgress,"primary");var i=t.nextPageQueryParams,u=l(e,6,0,"./");l(e,5,0,i,u),l(e,13,0,"chevron-right","inherit","flex-none")},function(l,e){var t=n.Pb(e,0,0,l(e,7,0,n.Gb(e.parent,0),"CBL.SEARCH.RESULTS_NEXT"));l(e,0,0,t,n.Gb(e,4).disabled?-1:n.Gb(e,4).tabIndex||0,n.Gb(e,4).disabled||null,n.Gb(e,4).disabled.toString(),"NoopAnimations"===n.Gb(e,4)._animationMode,n.Gb(e,5).target,n.Gb(e,5).href);var i=n.Pb(e,10,0,l(e,11,0,n.Gb(e.parent,0),"CBL.SEARCH.RESULTS_NEXT"));l(e,10,0,i),l(e,12,0,n.Gb(e,13).classes)})}function $l(l){return n.Qb(0,[n.Ib(0,j.a,[p.a]),(l()(),n.ub(1,0,null,null,8,"h3",[["class","component--results-info"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,zl)),n.tb(3,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.Ob(4,null,[" "," "])),(l()(),n.kb(16777216,null,null,1,null,Ql)),n.tb(6,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.Ob(7,null,[" "," "])),(l()(),n.ub(8,0,null,null,1,"span",[["class","executionInfo cb-font-weight-default cb-font-size-default cb-text-color-medium hide show-gt-sm"]],null,null,null,null,null)),(l()(),n.Ob(9,null,[" "," "]))],function(l,e){var t=e.component;l(e,3,0,t.showPageControls),l(e,6,0,t.showPageControls)},function(l,e){var t=e.component;l(e,4,0,t.rangeLabel),l(e,7,0,t.resultLabel),l(e,9,0,t.executionTimeLabel)})}var jl=t("dvHj"),Kl=t("Z7++"),Vl=t("Kfqh"),ql=t("C0xW"),Wl=t("sYue"),Xl=t("/q/h");class Jl{constructor(l,e,t,n){this.searchStateService=l,this.searchResultService=e,this.aggregateService=t,this.permissionService=n}ngOnInit(){this.searchInProgress=!1}ngOnChanges(){this.isShowingStatistics=this.getIsShowingStatistics(),this.canShowStatistics=this.getCanShowStatistics(),this.showUpsell=this.getShowUpsell(),this.isListOwner=this.getIsListOwner()}isDisabled(){return!this.isShowingStatistics&&!this.canShowStatistics&&!this.showUpsell}isAvailable(){return!this.isShowingStatistics&&this.canShowStatistics&&!this.showUpsell}isUpsell(){return!this.isShowingStatistics&&this.showUpsell}isToggled(){return this.isShowingStatistics&&(!this.showUpsell||!this.isListOwner)}showStatistics(){this.searchStateService.enableFieldAggregators(),this.searchResultService.search()}hideStatistics(){this.searchStateService.disableFieldAggregators()}getCanShowStatistics(){let{collectionId:l}=this.searchStateService.getSearchInfo(),e=this.searchStateService.getSelectedColumns();return this.aggregateService.getFieldAggregators(l,e).length>0}getIsShowingStatistics(){return this.searchStateService.getFieldAggregators().length>0}getShowUpsell(){return!this.permissionService.canAggregateFields()}getIsListOwner(){let l=this.searchStateService.getListModel();return!(!l||!l.is_owner)}}var Yl=n.sb({encapsulation:2,styles:[],data:{}});function Zl(l){return n.Qb(0,[(l()(),n.ub(0,16777216,null,null,9,"div",[["class","cb-text-color-medium"]],null,[[null,"longpress"],[null,"keydown"],[null,"touchend"]],function(l,e,t){var i=!0;return"longpress"===e&&(i=!1!==n.Gb(l,1).show()&&i),"keydown"===e&&(i=!1!==n.Gb(l,1)._handleKeydown(t)&&i),"touchend"===e&&(i=!1!==n.Gb(l,1)._handleTouchend()&&i),i},null,null)),n.tb(1,212992,null,0,jl.d,[D.c,n.k,Kl.b,n.P,n.y,Vl.a,s.c,s.f,jl.b,[2,U.b],[2,jl.a],[2,ql.g]],{message:[0,"message"]},null),n.Kb(2,1),(l()(),n.ub(3,0,null,null,6,"div",[["class","mat-button cb-text-transform-none"]],null,null,null,null,null)),(l()(),n.ub(4,0,null,null,5,"div",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(5,0,null,null,1,"icon",[["class","cb-margin-small-right flex-none"],["key","metrics"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(6,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(7,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(8,null,["",""])),n.Kb(9,1),(l()(),n.kb(0,null,null,0))],function(l,e){var t=n.Pb(e,1,0,l(e,2,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.NO_COLUMNS_WITH_STATS"));l(e,1,0,t),l(e,6,0,"metrics","cb-margin-small-right flex-none")},function(l,e){l(e,5,0,n.Gb(e,6).classes);var t=n.Pb(e,8,0,l(e,9,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.STATISTICS"));l(e,8,0,t)})}function le(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,9,"div",[],null,null,null,null,null)),(l()(),n.ub(1,0,null,null,8,"button",[["class","cb-text-transform-none"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(l,e,t){var n=!0;return"click"===e&&(n=!1!==l.component.showStatistics()&&n),n},i.d,i.b)),n.tb(2,180224,null,0,u.b,[n.k,s.f,[2,a.a]],{disabled:[0,"disabled"]},null),n.Kb(3,1),(l()(),n.ub(4,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(5,0,null,null,1,"icon",[["class","cb-margin-small-right flex-none"],["key","metrics"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(6,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(7,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(8,null,["",""])),n.Kb(9,1)],function(l,e){l(e,2,0,e.component.searchInProgress),l(e,6,0,"metrics","cb-margin-small-right flex-none")},function(l,e){var t=n.Pb(e,1,0,l(e,3,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.SHOW"));l(e,1,0,t,n.Gb(e,2).disabled||null,"NoopAnimations"===n.Gb(e,2)._animationMode),l(e,5,0,n.Gb(e,6).classes);var i=n.Pb(e,8,0,l(e,9,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.STATISTICS"));l(e,8,0,i)})}function ee(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,8,"button",[["class","cb-text-transform-none active"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(l,e,t){var n=!0;return"click"===e&&(n=!1!==l.component.hideStatistics()&&n),n},i.d,i.b)),n.tb(1,180224,null,0,u.b,[n.k,s.f,[2,a.a]],{disabled:[0,"disabled"]},null),n.Kb(2,1),(l()(),n.ub(3,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(4,0,null,null,1,"icon",[["class","cb-margin-small-right flex-none"],["key","metrics"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(5,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(6,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(7,null,["",""])),n.Kb(8,1)],function(l,e){l(e,1,0,e.component.searchInProgress),l(e,5,0,"metrics","cb-margin-small-right flex-none")},function(l,e){var t=n.Pb(e,0,0,l(e,2,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.STATISTICS"));l(e,0,0,t,n.Gb(e,1).disabled||null,"NoopAnimations"===n.Gb(e,1)._animationMode),l(e,4,0,n.Gb(e,5).classes);var i=n.Pb(e,7,0,l(e,8,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.STATISTICS"));l(e,7,0,i)})}function te(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,"upsell-button",[["featureSet","aggregates"]],null,null,null,Wl.b,Wl.a)),n.tb(1,114688,null,0,Xl.a,[R.a],{label:[0,"label"],featureSet:[1,"featureSet"]},null),n.Kb(2,1)],function(l,e){var t=n.Pb(e,1,0,l(e,2,0,n.Gb(e.parent,0),"CBL.SEARCH.STATISTICS.STATISTICS"));l(e,1,0,t,"aggregates")},null)}function ne(l){return n.Qb(0,[n.Ib(0,j.a,[p.a]),(l()(),n.ub(1,0,null,null,8,"div",[["class","component--aggregates-toggle"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,Zl)),n.tb(3,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,null,1,null,le)),n.tb(5,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,null,1,null,ee)),n.tb(7,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,null,1,null,te)),n.tb(9,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component;l(e,3,0,t.isDisabled()),l(e,5,0,t.isAvailable()),l(e,7,0,t.isToggled()),l(e,9,0,t.isUpsell())},null)}var ie=t("jKVQ");class ue{constructor(l,e,t,n,i){this.activeSearchExportService=l,this.permissionService=e,this.progressService=t,this.errorService=n,this.billingService=i,this.state$=Object(ie.b)({hasExportableColumns:this.activeSearchExportService.hasExportableColumns$(),hasPermission:this.permissionService.getPermissions().pipe(Object(I.a)(l=>l.canExportAsCsv()))})}ngOnInit(){this.upsellFeatureSet=this.billingService.isInProTrial()?"export_no_trial":"export"}export(){this.progressService.startProgress("SEARCH-EXPORT"),this.activeSearchExportService.exportToCsv$().subscribe({next:()=>this.progressService.stopProgress("SEARCH-EXPORT"),error:l=>{this.errorService.showToast(l),this.progressService.stopProgress("SEARCH-EXPORT")}})}}var se=t("jV/k"),ae=t("vfyW"),re=t("gb1R"),oe=t("e5VU"),ce=function(l){return l[l.NUMBER=0]="NUMBER",l[l.TEXT=1]="TEXT",l[l.PERMALINK=2]="PERMALINK",l[l.DATE=3]="DATE",l}({});let be=(()=>{class l{constructor(l,e,t,n,i,u,s,a){this.csvService=l,this.fieldFormatterService=e,this.metadataService=t,this.dialogService=n,this.permService=i,this.labelService=u,this.themeService=s,this.urlService=a}exportEntitiesToCsv(l,e,t,n){n=n||[];let i=this.buildExportTitle(l,e);this.checkForLimitAndExport(i,e,t,n)}hasExportableColumns(l,e){return this.getSuppressedColumns(l,e).length<e.length}checkForLimitAndExport(l,e,t,n){const i=this.permService.getDisplaySearchResultLimit();n.length>=i?this.showExportLimitWarning().then(i=>{i&&this.checkForSuppressionAndExport(l,e,t,n)}):this.checkForSuppressionAndExport(l,e,t,n)}checkForSuppressionAndExport(l,e,t,n){const i=this.getSuppressedColumns(e,t);i.length>0?this.showSuppressedColumnsWarning(e,i).then(u=>{u&&this.doCsvExport(l,e,Object(K.difference)(t,i),n)}):this.doCsvExport(l,e,t,n)}doCsvExport(l,e,t,n){let i=this.buildOutputColumns(e,t),u=this.buildFormattedData(i,n),s=i.map(l=>l.fieldName);this.csvService.downloadCSVData(l,s,u)}buildOutputColumns(e,t){let n=[];return t.forEach(t=>{let i=this.metadataService.getField(e,t),u=l.SUBFIELDS[i.type_id],s="";if(i.facet_id){const l=this.metadataService.getFacet(e,i.facet_id),t=this.metadataService.getFieldTheme(e,i.id);this.themeService.isPartnerTheme(t.id)&&l&&l.labels&&(s=`${l.labels.name} - `)}u?Object(K.forEach)(u,l=>{let e=this.getSuffix(l.suffixLabel);n.push({field:i,fieldName:`${s}${i.labels.name+e}`,subfieldId:l.id,subfieldType:l.type})}):n.push({field:i,fieldName:`${s}${i.labels.name}`})}),n}buildFormattedData(l,e){let t=[];return Object(K.forEach)(e,e=>{let n={};l.forEach(l=>{let t;(t=l.subfieldId?this.formatSubfield(l,e):this.fieldFormatterService.formatField(l.field,e.properties[l.field.id],ml.a.export).toString())===ml.b&&(t=""),n[l.fieldName]=t}),t.push(n)}),t}buildExportTitle(l,e){let t,n=(new Date).toLocaleDateString();return t=l?l+n:this.metadataService.getEntityDef(e).labels.plural+n,Object(K.kebabCase)(t)}showExportLimitWarning(){let l=this.labelService.getLabel("CBL.EXPORT.EXPORT_RESULT_LIMIT"),e=this.labelService.getInterpolatedLabel("CBL.EXPORT.ROW_LIMIT_EXPLANATION",{max:""+this.permService.getDisplaySearchResultLimit()}),t=this.labelService.getLabel("CBL.EXPORT.CONTINUE"),n=this.labelService.getLabel("CBL.COMMON.CANCEL");return this.dialogService.showConfirmation(l,e,t,n)}getSuffix(l){return l?" "+this.labelService.getLabel(l):""}formatSubfield(l,e){let t=e.properties[l.field.id];if(!Object(K.isObject)(t))return"";if(l.subfieldType===ce.PERMALINK){let l=this.urlService.getEntityExternalUrl(t);return this.urlService.getAbsoluteUrl(l)}{let e=t[l.subfieldId]||"";return l.subfieldType===ce.NUMBER?e=e.toString():l.subfieldType===ce.DATE&&(e=this.fieldFormatterService.formatField(l.field,t,ml.a.export)),e}}getSuppressedColumns(l,e){let t=this.metadataService.getEntityDef(l);return t&&t.display&&t.display.suppress_export?e:e.filter(e=>{let t=this.metadataService.getField(l,e),n=t&&this.metadataService.getFacet(l,t.facet_id);return!!(n&&n.display&&n.display.suppress_export)})}showSuppressedColumnsWarning(l,e){let t=e.map(e=>{let t=this.metadataService.getField(l,e);return t?t.labels.name:e}),n=this.labelService.getLabel("CBL.EXPORT.SUPPRESSED_WARNING"),i=this.labelService.getInterpolatedLabel("CBL.EXPORT.SUPPRESSED_WARNING_MESSAGE",{columns:t.join(", ")}),u=this.labelService.getLabel("CBL.EXPORT.CONTINUE"),s=this.labelService.getLabel("CBL.COMMON.CANCEL");return this.dialogService.showConfirmation(n,i,u,s)}}return l.SUBFIELDS={identifier:[{id:"value",type:ce.TEXT},{id:"permalink",suffixLabel:"CBL.SUBFIELDS.URL",type:ce.PERMALINK}],money:[{id:"value",type:ce.NUMBER},{id:"currency",suffixLabel:"CBL.SUBFIELDS.CURRENCY",type:ce.TEXT},{id:"value_usd",suffixLabel:"CBL.SUBFIELDS.CURRENCY_USD",type:ce.NUMBER}],money_decimal:[{id:"value",type:ce.NUMBER},{id:"currency",suffixLabel:"CBL.SUBFIELDS.CURRENCY",type:ce.TEXT},{id:"value_usd",suffixLabel:"CBL.SUBFIELDS.CURRENCY_USD",type:ce.NUMBER}],date_precision:[{id:"value",type:ce.DATE},{id:"precision",suffixLabel:"CBL.SUBFIELDS.PRECISION",type:ce.TEXT}]},l.ngInjectableDef=n.Ub({factory:function(){return new l(n.Vb(re.a),n.Vb(rl.b),n.Vb(h.a),n.Vb(R.a),n.Vb(A.a),n.Vb(p.a),n.Vb(F.a),n.Vb(oe.a))},token:l,providedIn:"root"}),l})(),de=(()=>{class l{constructor(l,e,t){this.searchStateService=l,this.searchResultService=e,this.exportService=t}exportToCsv$(){const l=this.searchStateService.getActiveSearch(),e=l&&l.getColumns();if(!e)return Object(se.a)();const t=l.getList();return this.searchResultService.getFullSearchResults().pipe(Object(ae.a)(n=>{this.exportService.exportEntitiesToCsv(t&&t.name,l.collectionId,e,n.data.entities)}),Object(I.a)(l=>void 0))}hasExportableColumns$(){return Object(se.a)(!0)}}return l.ngInjectableDef=n.Ub({factory:function(){return new l(n.Vb(E.a),n.Vb(L.a),n.Vb(be))},token:l,providedIn:"root"}),l})();var he=t("rMqR"),ge=n.sb({encapsulation:2,styles:[],data:{}});function me(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,9,"button",[["disabled",""],["mat-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],null,null,i.d,i.b)),n.tb(1,180224,null,0,u.b,[n.k,s.f,[2,a.a]],{disabled:[0,"disabled"]},null),(l()(),n.ub(2,16777216,null,0,7,"span",[["class","layout-row layout-align-start-center"]],null,[[null,"longpress"],[null,"keydown"],[null,"touchend"]],function(l,e,t){var i=!0;return"longpress"===e&&(i=!1!==n.Gb(l,3).show()&&i),"keydown"===e&&(i=!1!==n.Gb(l,3)._handleKeydown(t)&&i),"touchend"===e&&(i=!1!==n.Gb(l,3)._handleTouchend()&&i),i},null,null)),n.tb(3,212992,null,0,jl.d,[D.c,n.k,Kl.b,n.P,n.y,Vl.a,s.c,s.f,jl.b,[2,U.b],[2,jl.a],[2,ql.g]],{message:[0,"message"]},null),n.Kb(4,1),(l()(),n.ub(5,0,null,null,1,"icon",[["class","flex-none cb-margin-small-right"],["color","disabled"],["key","download"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(6,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],color:[1,"color"],class:[2,"class"]},null),(l()(),n.ub(7,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(8,null,["",""])),n.Kb(9,1)],function(l,e){l(e,1,0,"");var t=n.Pb(e,3,0,l(e,4,0,n.Gb(e.parent.parent,0),"CBL.SEARCH.EXPORT_ALL_SUPPRESSED"));l(e,3,0,t),l(e,6,0,"download","disabled","flex-none cb-margin-small-right")},function(l,e){l(e,0,0,n.Gb(e,1).disabled||null,"NoopAnimations"===n.Gb(e,1)._animationMode),l(e,5,0,n.Gb(e,6).classes);var t=n.Pb(e,8,0,l(e,9,0,n.Gb(e.parent.parent,0),"CBL.LISTS.EXPORT_AS_CSV"));l(e,8,0,t)})}function pe(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,7,"button",[["mat-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(l,e,t){var n=!0;return"click"===e&&(n=!1!==l.component.export()&&n),n},i.d,i.b)),n.tb(1,180224,null,0,u.b,[n.k,s.f,[2,a.a]],null,null),(l()(),n.ub(2,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(3,0,null,null,1,"icon",[["class","flex-none cb-margin-small-right"],["key","download"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(4,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(5,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(6,null,["",""])),n.Kb(7,1)],function(l,e){l(e,4,0,"download","flex-none cb-margin-small-right")},function(l,e){l(e,0,0,n.Gb(e,1).disabled||null,"NoopAnimations"===n.Gb(e,1)._animationMode),l(e,3,0,n.Gb(e,4).classes);var t=n.Pb(e,6,0,l(e,7,0,n.Gb(e.parent.parent,0),"CBL.LISTS.EXPORT_AS_CSV"));l(e,6,0,t)})}function fe(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,"upsell-button",[],null,null,null,Wl.b,Wl.a)),n.tb(1,114688,null,0,Xl.a,[R.a],{label:[0,"label"],featureSet:[1,"featureSet"]},null),n.Kb(2,1)],function(l,e){var t=e.component,i=n.Pb(e,1,0,l(e,2,0,n.Gb(e.parent.parent,0),"CBL.LISTS.EXPORT_AS_CSV"));l(e,1,0,i,t.upsellFeatureSet)},null)}function Se(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,6,null,null,null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,me)),n.tb(2,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,null,1,null,pe)),n.tb(4,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,null,1,null,fe)),n.tb(6,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(0,null,null,0))],function(l,e){l(e,2,0,e.context.ngIf.hasPermission&&!e.context.ngIf.hasExportableColumns),l(e,4,0,e.context.ngIf.hasPermission&&e.context.ngIf.hasExportableColumns),l(e,6,0,!e.context.ngIf.hasPermission)},null)}function ve(l){return n.Qb(2,[n.Ib(0,j.a,[p.a]),(l()(),n.kb(16777216,null,null,2,null,Se)),n.tb(2,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),n.Ib(131072,r.b,[n.h])],function(l,e){var t=e.component;l(e,2,0,n.Pb(e,2,0,n.Gb(e,3).transform(t.state$)))},null)}t("aMtI"),t("89Cg"),t.d(e,"a",function(){return Ie}),t.d(e,"b",function(){return Ue});var Ie=n.sb({encapsulation:2,styles:[],data:{}});function ye(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,6,"button",[["class","flex-none"],["color","accent"],["mat-raised-button",""],["type","submit"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(l,e,t){var n=!0;return"click"===e&&(n=!1!==l.component.searchClickHandler()&&n),n},i.d,i.b)),n.tb(1,180224,null,0,u.b,[n.k,s.f,[2,a.a]],{disabled:[0,"disabled"],color:[1,"color"]},null),n.Ib(131072,r.b,[n.h]),n.Kb(3,1),(l()(),n.ub(4,0,null,0,2,"span",[],null,null,null,null,null)),(l()(),n.Ob(5,null,["",""])),n.Kb(6,1)],function(l,e){var t=e.component;l(e,1,0,n.Pb(e,1,0,n.Gb(e,2).transform(t.searchInProgress)),"accent")},function(l,e){var t=n.Pb(e,0,0,l(e,3,0,n.Gb(e.parent,0),"CBL.SEARCH.SEARCH"));l(e,0,0,t,n.Gb(e,1).disabled||null,"NoopAnimations"===n.Gb(e,1)._animationMode);var i=n.Pb(e,5,0,l(e,6,0,n.Gb(e.parent,0),"CBL.SEARCH.SEARCH"));l(e,5,0,i)})}function ke(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,1,"results-quick-add",[],null,null,null,P,x)),n.tb(1,245760,[[1,4]],0,C,[E.a,L.a],null,null)],function(l,e){l(e,1,0)},null)}function Ce(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,1,"add-remove-buttons",[],null,[[null,"entriesRemoved"],[null,"clearSelected"]],function(l,e,t){var n=!0,i=l.component;return"entriesRemoved"===e&&(n=!1!==i.handleRemove()&&n),"clearSelected"===e&&(n=!1!==i.deselectAll()&&n),n},w.c,w.b)),n.tb(1,770048,null,0,G.a,[d.b,m.a,R.a,E.a,A.a,T.a,f.a],{searchId:[0,"searchId"],selectedEntities:[1,"selectedEntities"],selectedCount:[2,"selectedCount"],isCapped:[3,"isCapped"]},{entriesRemoved:"entriesRemoved",clearSelected:"clearSelected"})],function(l,e){var t=e.component;l(e,1,0,t.search.id,t.selectedRows,t.selectedRows.size,t.selectIsCapped)},null)}function Ee(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,"grid-column-header",[],null,[[null,"removeSort"],[null,"sort"],[null,"move"],[null,"remove"]],function(l,e,t){var n=!0,i=l.component;return"removeSort"===e&&(n=!1!==i.removeSort(t)&&n),"sort"===e&&(n=!1!==i.setSort(t)&&n),"move"===e&&(n=!1!==i.moveColumn(t)&&n),"remove"===e&&(n=!1!==i.removeColumn(t)&&n),n},O.b,O.a)),n.tb(1,4308992,null,0,_.a,[n.k,n.D,p.a,F.a],{columnId:[0,"columnId"],isSheetGrid:[1,"isSheetGrid"],theme:[2,"theme"],facet:[3,"facet"],sortable:[4,"sortable"],currentSort:[5,"currentSort"],sortUpsell:[6,"sortUpsell"],movable:[7,"movable"],isFirst:[8,"isFirst"],isLast:[9,"isLast"],removable:[10,"removable"]},{sort:"sort",removeSort:"removeSort",move:"move",remove:"remove"}),(l()(),n.Ob(2,0,[" "," "]))],function(l,e){var t=e.component;l(e,1,1,[e.context.$implicit.id,!0,e.context.$implicit.theme,e.context.$implicit.facet,e.context.$implicit.isSortable,t.order&&t.order.field_id===e.context.$implicit.id?t.order.sort:"",e.context.$implicit.sortUpsell,!0,e.context.first,e.context.last,!0])},function(l,e){l(e,2,0,e.context.$implicit.labels&&e.context.$implicit.labels.name?e.context.$implicit.labels.name:e.context.$implicit.id)})}function Le(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,1,"div",[["class","flex-none cb-text-color-medium cb-margin-medium-left"]],null,null,null,null,null)),(l()(),n.Ob(1,null,[" ",". "]))],null,function(l,e){var t=e.component;l(e,1,0,e.parent.parent.context.index+1+t.pageSize*(t.currentPage-1))})}function xe(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,1,"drill-in-menu",[["class","flex-none cb-margin-medium-right"]],null,null,null,nl,J)),n.tb(1,114688,null,0,V,[X,S.a],{identifierFieldData:[0,"identifierFieldData"]},null)],function(l,e){l(e,1,0,e.parent.parent.context.$implicit.properties[e.parent.context.$implicit.id])},null)}function Pe(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,9,"grid-cell",[],null,null,null,il.b,il.a)),n.tb(1,4243456,null,0,ul.a,[n.k,n.D],{columnId:[0,"columnId"]},null),(l()(),n.kb(16777216,null,0,1,null,Le)),n.tb(3,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.ub(4,0,null,0,2,"field-formatter",[["class","cb-margin-medium-horizontal"]],null,null,null,sl.b,sl.a)),n.tb(5,114688,null,0,al.a,[rl.b],{collectionId:[0,"collectionId"],field:[1,"field"],fieldData:[2,"fieldData"],queryData:[3,"queryData"]},null),n.Jb(6,{localProperties:0}),(l()(),n.ub(7,0,null,0,0,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,0,1,null,xe)),n.tb(9,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component;l(e,1,0,e.context.$implicit.id),l(e,3,0,0==e.context.index);var n=t.collectionId,i=e.context.$implicit,u=e.parent.context.$implicit.properties[e.context.$implicit.id],s=l(e,6,0,e.parent.context.$implicit.properties);l(e,5,0,n,i,u,s),l(e,9,0,"identifier"===(null==e.context.$implicit?null:e.context.$implicit.type_id)&&"identifier"===e.context.$implicit.id)},null)}function we(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,8,"grid-row",[],null,null,null,ol.b,ol.a)),n.tb(1,49152,[[8,4]],0,cl.a,[],null,null),(l()(),n.ub(2,0,null,0,4,"grid-cell",[["class","select"],["columnId","select"]],null,null,null,il.b,il.a)),n.tb(3,4243456,null,0,ul.a,[n.k,n.D],{columnId:[0,"columnId"]},null),(l()(),n.ub(4,0,null,0,2,"checkbox",[],null,[[null,"toggleChecked"]],function(l,e,t){var n=!0;return"toggleChecked"===e&&(n=!1!==l.component.setIsSelected(t,l.context.$implicit)&&n),n},bl.b,bl.a)),n.tb(5,638976,null,0,dl.a,[],{isChecked:[0,"isChecked"],ariaLabel:[1,"ariaLabel"]},{toggleChecked:"toggleChecked"}),n.Kb(6,1),(l()(),n.kb(16777216,null,0,1,null,Pe)),n.tb(8,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"],ngForTrackBy:[1,"ngForTrackBy"]},null)],function(l,e){var t=e.component;l(e,3,0,"select");var i=t.isRowSelected(e.context.$implicit),u=n.Pb(e,5,1,l(e,6,0,n.Gb(e.parent.parent,0),"CBL.SEARCH.TOGGLE"));l(e,5,0,i,u),l(e,8,0,t.columns,t.trackByColumnId)},null)}function Ge(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,"div",[["class","flex-none cb-text-color-medium cb-margin-medium-left"]],null,null,null,null,null)),(l()(),n.ub(1,0,null,null,1,"span",[["class","number"]],null,null,null,null,null)),(l()(),n.Ob(2,null,[" ",". "]))],null,function(l,e){l(e,2,0,e.parent.parent.context.index+(e.component.rows.length+1))})}function Re(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,6,"grid-cell",[],null,null,null,il.b,il.a)),n.tb(1,4243456,null,0,ul.a,[n.k,n.D],{columnId:[0,"columnId"]},null),(l()(),n.kb(16777216,null,0,1,null,Ge)),n.tb(3,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.ub(4,0,null,0,2,"field-formatter",[["class","cb-margin-medium-horizontal"]],null,null,null,sl.b,sl.a)),n.tb(5,114688,null,0,al.a,[rl.b],{collectionId:[0,"collectionId"],field:[1,"field"],fieldData:[2,"fieldData"],queryData:[3,"queryData"]},null),n.Jb(6,{localProperties:0})],function(l,e){var t=e.component;l(e,1,0,e.context.$implicit.id),l(e,3,0,0==e.context.index);var n=t.collectionId,i=e.context.$implicit,u=e.parent.context.$implicit.properties[e.context.$implicit.id],s=l(e,6,0,e.parent.context.$implicit.properties);l(e,5,0,n,i,u,s)},null)}function Ae(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,7,"grid-row",[["class","blurred-row"]],null,null,null,ol.b,ol.a)),n.tb(1,49152,[[8,4]],0,cl.a,[],null,null),(l()(),n.ub(2,0,null,0,3,"grid-cell",[["class","select"],["columnId","select"]],null,null,null,il.b,il.a)),n.tb(3,4243456,null,0,ul.a,[n.k,n.D],{columnId:[0,"columnId"]},null),(l()(),n.ub(4,0,null,0,1,"checkbox",[],null,null,null,bl.b,bl.a)),n.tb(5,638976,null,0,dl.a,[],{isChecked:[0,"isChecked"]},null),(l()(),n.kb(16777216,null,0,1,null,Re)),n.tb(7,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"],ngForTrackBy:[1,"ngForTrackBy"]},null)],function(l,e){var t=e.component;l(e,3,0,"select"),l(e,5,0,!1),l(e,7,0,t.columns,t.trackByColumnId)},null)}function Te(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,Ae)),n.tb(2,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"]},null),(l()(),n.kb(0,null,null,0))],function(l,e){l(e,2,0,e.component.blurredRows)},null)}function Oe(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,2,"div",[["class","all-results-upsell-wrapper"]],null,null,null,null,null)),(l()(),n.ub(1,0,null,null,1,"upsell",[["featureSet","all_results"]],null,null,null,hl.b,hl.a)),n.tb(2,49152,null,0,gl.a,[],{featureSet:[0,"featureSet"],context:[1,"context"]},null)],function(l,e){l(e,2,0,"all_results",e.component.upsellHeadLineTextContext)},null)}function _e(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,1,"upsell",[["featureSet","forbidden"]],null,null,null,hl.b,hl.a)),n.tb(1,49152,null,0,gl.a,[],{featureSet:[0,"featureSet"]},null)],function(l,e){l(e,1,0,"forbidden")},null)}function Fe(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,4,null,null,null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,Oe)),n.tb(2,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(16777216,null,null,1,null,_e)),n.tb(4,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.kb(0,null,null,0))],function(l,e){var t=e.component;l(e,2,0,t.showAllResultsUpsell),l(e,4,0,t.showForbiddenUpsell)},null)}function Me(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,1,"aggregates",[["class","flex"]],null,null,null,Cl,Sl)),n.tb(1,573440,null,0,pl,[p.a,E.a,fl.a,h.a,rl.b],{fieldId:[0,"fieldId"],search:[1,"search"],resultStats:[2,"resultStats"],fieldAggregates:[3,"fieldAggregates"]},null)],function(l,e){var t=e.component;l(e,1,0,e.parent.context.$implicit.id,t.search,t.results.stats,t.aggregates[e.parent.context.$implicit.id])},null)}function Ne(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,3,"grid-cell",[],null,null,null,il.b,il.a)),n.tb(1,4243456,null,0,ul.a,[n.k,n.D],{columnId:[0,"columnId"]},null),(l()(),n.kb(16777216,null,0,1,null,Me)),n.tb(3,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component;l(e,1,0,e.context.$implicit.id),l(e,3,0,t.aggregates[e.context.$implicit.id])},null)}function Be(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,5,"grid-footer",[],null,null,null,xl,Ll)),n.tb(1,49152,[[4,4]],0,El,[],null,null),(l()(),n.ub(2,0,null,0,1,"grid-cell",[["class","select"],["columnId","select"]],null,null,null,il.b,il.a)),n.tb(3,4243456,null,0,ul.a,[n.k,n.D],{columnId:[0,"columnId"]},null),(l()(),n.kb(16777216,null,0,1,null,Ne)),n.tb(5,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"],ngForTrackBy:[1,"ngForTrackBy"]},null)],function(l,e){var t=e.component;l(e,3,0,"select"),l(e,5,0,t.columns,t.trackByColumnId)},null)}function De(l){return n.Qb(0,[(l()(),n.ub(0,0,null,null,77,"sheet-grid",[],null,null,null,Pl.b,Pl.a)),n.tb(1,13156352,null,3,wl.a,[Gl.a,n.y,n.D],{gridId:[0,"gridId"],columns:[1,"columns"],rows:[2,"rows"],hasFooter:[3,"hasFooter"],hasResizableColumns:[4,"hasResizableColumns"]},null),n.Mb(603979776,2,{header:0}),n.Mb(603979776,3,{body:0}),n.Mb(603979776,4,{footer:0}),n.Kb(5,3),(l()(),n.ub(6,0,null,0,52,"grid-header",[],null,null,null,Rl.b,Rl.a)),n.tb(7,49152,[[2,4]],0,Al.a,[],null,null),(l()(),n.ub(8,0,null,0,48,"grid-column-header",[["class","select-header"]],null,null,null,O.b,O.a)),n.tb(9,4308992,null,0,_.a,[n.k,n.D,p.a,F.a],{isSheetGrid:[0,"isSheetGrid"],sortable:[1,"sortable"],movable:[2,"movable"],removable:[3,"removable"]},null),(l()(),n.ub(10,16777216,null,0,5,"button",[["aria-haspopup","true"],["class","flex-none header-icon mat-menu-trigger"],["mat-icon-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null],[1,"aria-expanded",0]],[[null,"mousedown"],[null,"keydown"],[null,"click"]],function(l,e,t){var i=!0;return"mousedown"===e&&(i=!1!==n.Gb(l,12)._handleMousedown(t)&&i),"keydown"===e&&(i=!1!==n.Gb(l,12)._handleKeydown(t)&&i),"click"===e&&(i=!1!==n.Gb(l,12)._handleClick(t)&&i),i},i.d,i.b)),n.tb(11,180224,null,0,u.b,[n.k,s.f,[2,a.a]],null,null),n.tb(12,1196032,null,0,N.h,[D.c,n.k,n.P,N.c,[2,N.d],[8,null],[2,U.b],s.f],{menu:[0,"menu"]},null),n.Kb(13,1),(l()(),n.ub(14,0,null,0,1,"icon",[["key","expand-more"],["size","large"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(15,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],size:[1,"size"]},null),(l()(),n.ub(16,0,null,0,40,"mat-menu",[["class","grid-column-menu"]],null,null,null,M.d,M.b)),n.tb(17,1294336,[["columnMenu",4]],3,N.i,[n.k,n.y,N.a],{overlapTrigger:[0,"overlapTrigger"],panelClass:[1,"panelClass"]},null),n.Mb(603979776,5,{_allItems:1}),n.Mb(603979776,6,{items:1}),n.Mb(603979776,7,{lazyContent:0}),n.Lb(2048,null,N.d,null,[N.i]),n.Lb(2048,null,N.b,null,[N.d]),(l()(),n.ub(23,0,null,0,7,"button",[["class","dropdown-menu-link mat-menu-item"],["mat-menu-item",""]],[[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0,u=l.component;return"click"===e&&(i=!1!==n.Gb(l,24)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,24)._handleMouseEnter()&&i),"click"===e&&(i=!1!==u.selectPage()&&i),i},M.c,M.a)),n.tb(24,180224,[[5,4],[6,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),(l()(),n.ub(25,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(26,0,null,null,1,"icon",[["class","cb-margin-medium-right flex-none"],["key","list-outline"],["size","large"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(27,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],size:[1,"size"],class:[2,"class"]},null),(l()(),n.ub(28,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(29,null,["",""])),n.Kb(30,1),(l()(),n.ub(31,0,null,0,7,"button",[["class","dropdown-menu-link mat-menu-item"],["mat-menu-item",""]],[[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0,u=l.component;return"click"===e&&(i=!1!==n.Gb(l,32)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,32)._handleMouseEnter()&&i),"click"===e&&(i=!1!==u.selectAll()&&i),i},M.c,M.a)),n.tb(32,180224,[[5,4],[6,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),(l()(),n.ub(33,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(34,0,null,null,1,"icon",[["class","cb-margin-medium-right flex-none"],["key","select-all"],["size","large"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(35,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],size:[1,"size"],class:[2,"class"]},null),(l()(),n.ub(36,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(37,null,["",""])),n.Kb(38,1),(l()(),n.ub(39,0,null,0,1,"mat-divider",[["class","mat-divider"],["role","separator"]],[[1,"aria-orientation",0],[2,"mat-divider-vertical",null],[2,"mat-divider-horizontal",null],[2,"mat-divider-inset",null]],null,null,Q.b,Q.a)),n.tb(40,49152,null,0,$.a,[],null,null),(l()(),n.ub(41,0,null,0,7,"button",[["class","dropdown-menu-link mat-menu-item"],["mat-menu-item",""]],[[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0,u=l.component;return"click"===e&&(i=!1!==n.Gb(l,42)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,42)._handleMouseEnter()&&i),"click"===e&&(i=!1!==u.deselectPage()&&i),i},M.c,M.a)),n.tb(42,180224,[[5,4],[6,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),(l()(),n.ub(43,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(44,0,null,null,1,"icon",[["class","cb-margin-medium-right flex-none"],["key","deselect-page"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(45,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(46,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(47,null,["",""])),n.Kb(48,1),(l()(),n.ub(49,0,null,0,7,"button",[["class","dropdown-menu-link mat-menu-item"],["mat-menu-item",""]],[[1,"role",0],[2,"mat-menu-item-highlighted",null],[2,"mat-menu-item-submenu-trigger",null],[1,"tabindex",0],[1,"aria-disabled",0],[1,"disabled",0]],[[null,"click"],[null,"mouseenter"]],function(l,e,t){var i=!0,u=l.component;return"click"===e&&(i=!1!==n.Gb(l,50)._checkDisabled(t)&&i),"mouseenter"===e&&(i=!1!==n.Gb(l,50)._handleMouseEnter()&&i),"click"===e&&(i=!1!==u.deselectAll()&&i),i},M.c,M.a)),n.tb(50,180224,[[5,4],[6,4]],0,N.f,[n.k,r.e,s.f,[2,N.b]],null,null),(l()(),n.ub(51,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(52,0,null,null,1,"icon",[["class","cb-margin-medium-right flex-none"],["key","deselect-all"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(53,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(54,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(55,null,["",""])),n.Kb(56,1),(l()(),n.kb(16777216,null,0,1,null,Ee)),n.tb(58,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"],ngForTrackBy:[1,"ngForTrackBy"]},null),(l()(),n.ub(59,0,null,0,16,"grid-body",[],null,null,null,Tl.b,Tl.a)),n.Lb(512,null,r.F,r.G,[n.r,n.s,n.k,n.D]),n.tb(61,278528,null,0,r.n,[r.F],{ngClass:[0,"ngClass"]},null),n.Jb(62,{"show-all-results-upsell":0}),n.tb(63,49152,[[3,4]],1,Ol.a,[],null,null),n.Mb(603979776,8,{rows:1}),(l()(),n.ub(65,0,null,0,2,"no-content",[["class","cb-absolute-to-cover-top"]],null,null,null,_l.b,_l.a)),n.tb(66,49152,null,0,Fl.a,[],{showLoading:[0,"showLoading"]},null),n.Ib(131072,r.b,[n.h]),(l()(),n.kb(16777216,null,0,1,null,we)),n.tb(69,278528,null,0,r.o,[n.P,n.L,n.r],{ngForOf:[0,"ngForOf"],ngForTrackBy:[1,"ngForTrackBy"]},null),(l()(),n.kb(16777216,null,0,2,null,Te)),n.tb(71,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),n.Ib(131072,r.b,[n.h]),(l()(),n.kb(16777216,null,0,2,null,Fe)),n.tb(74,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),n.Ib(131072,r.b,[n.h]),(l()(),n.kb(16777216,null,0,1,null,Be)),n.tb(77,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component,i=n.Pb(e,1,0,l(e,5,0,n.Gb(e.parent,1),t.collectionId,".","-"));l(e,1,0,i,t.columns,t.rows,t.shouldShowStatistics(),!0),l(e,9,0,!0,!1,!1,!1),l(e,12,0,n.Gb(e,17)),l(e,15,0,"expand-more","large"),l(e,17,0,!1,"grid-column-menu"),l(e,27,0,"list-outline","large","cb-margin-medium-right flex-none"),l(e,35,0,"select-all","large","cb-margin-medium-right flex-none"),l(e,45,0,"deselect-page","cb-margin-medium-right flex-none"),l(e,53,0,"deselect-all","cb-margin-medium-right flex-none"),l(e,58,0,t.columns,t.trackByColumnId);var u=l(e,62,0,t.showAllResultsUpsell);l(e,61,0,u),l(e,66,0,n.Pb(e,66,0,n.Gb(e,67).transform(t.searchInProgress))),l(e,69,0,t.rows,t.trackByRow),l(e,71,0,t.showAllResultsUpsell&&!n.Pb(e,71,0,n.Gb(e,72).transform(t.searchInProgress))),l(e,74,0,!n.Pb(e,74,0,n.Gb(e,75).transform(t.searchInProgress))),l(e,77,0,t.shouldShowStatistics())},function(l,e){var t=n.Pb(e,10,0,l(e,13,0,n.Gb(e.parent,0),"CBL.SEARCH.COLUMN_MENU.MENU_BUTTON"));l(e,10,0,t,n.Gb(e,11).disabled||null,"NoopAnimations"===n.Gb(e,11)._animationMode,n.Gb(e,12).menuOpen||null),l(e,14,0,n.Gb(e,15).classes),l(e,23,0,n.Gb(e,24).role,n.Gb(e,24)._highlighted,n.Gb(e,24)._triggersSubmenu,n.Gb(e,24)._getTabIndex(),n.Gb(e,24).disabled.toString(),n.Gb(e,24).disabled||null),l(e,26,0,n.Gb(e,27).classes);var i=n.Pb(e,29,0,l(e,30,0,n.Gb(e.parent,0),"CBL.SEARCH.COLUMN_MENU.SELECT_PAGE"));l(e,29,0,i),l(e,31,0,n.Gb(e,32).role,n.Gb(e,32)._highlighted,n.Gb(e,32)._triggersSubmenu,n.Gb(e,32)._getTabIndex(),n.Gb(e,32).disabled.toString(),n.Gb(e,32).disabled||null),l(e,34,0,n.Gb(e,35).classes);var u=n.Pb(e,37,0,l(e,38,0,n.Gb(e.parent,0),"CBL.SEARCH.COLUMN_MENU.SELECT_ALL"));l(e,37,0,u),l(e,39,0,n.Gb(e,40).vertical?"vertical":"horizontal",n.Gb(e,40).vertical,!n.Gb(e,40).vertical,n.Gb(e,40).inset),l(e,41,0,n.Gb(e,42).role,n.Gb(e,42)._highlighted,n.Gb(e,42)._triggersSubmenu,n.Gb(e,42)._getTabIndex(),n.Gb(e,42).disabled.toString(),n.Gb(e,42).disabled||null),l(e,44,0,n.Gb(e,45).classes);var s=n.Pb(e,47,0,l(e,48,0,n.Gb(e.parent,0),"CBL.SEARCH.COLUMN_MENU.DESELECT_PAGE"));l(e,47,0,s),l(e,49,0,n.Gb(e,50).role,n.Gb(e,50)._highlighted,n.Gb(e,50)._triggersSubmenu,n.Gb(e,50)._getTabIndex(),n.Gb(e,50).disabled.toString(),n.Gb(e,50).disabled||null),l(e,52,0,n.Gb(e,53).classes);var a=n.Pb(e,55,0,l(e,56,0,n.Gb(e.parent,0),"CBL.SEARCH.COLUMN_MENU.DESELECT_ALL"));l(e,55,0,a)})}function Ue(l){return n.Qb(0,[n.Ib(0,j.a,[p.a]),n.Ib(0,Ml.a,[]),n.Mb(671088640,1,{quickAdd:0}),(l()(),n.ub(3,0,null,null,45,"div",[["class","component--results flex layout-column"]],null,null,null,null,null)),(l()(),n.ub(4,0,null,null,44,"div",[["class","gridChrome mat-elevation-z2 flex layout-column"]],null,null,null,null,null)),(l()(),n.ub(5,0,null,null,37,"div",[["class","cb-background-white cb-padding-small-vertical\n                cb-padding-medium-horizontal flex-none layout-column\n                layout-align-center-stretch layout-gt-xs-row\n                layout-align-gt-xs-start-center"]],null,null,null,null,null)),(l()(),n.ub(6,0,null,null,2,"results-info",[["class","flex-none hide-gt-xs"]],null,null,null,$l,Hl)),n.Lb(512,null,Nl.a,Nl.a,[]),n.tb(8,704512,null,0,Dl,[Nl.a,p.a,Ul.a,L.a,E.a,A.a],{results:[0,"results"],pageId:[1,"pageId"],pageSize:[2,"pageSize"]},null),(l()(),n.ub(9,0,null,null,33,"div",[["class","flex layout-row layout-wrap layout-align-start-center"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,ye)),n.tb(11,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.ub(12,0,null,null,2,"results-info",[["class","flex-none hide show-gt-xs"]],null,null,null,$l,Hl)),n.Lb(512,null,Nl.a,Nl.a,[]),n.tb(14,704512,null,0,Dl,[Nl.a,p.a,Ul.a,L.a,E.a,A.a],{results:[0,"results"],pageId:[1,"pageId"],pageSize:[2,"pageSize"]},null),(l()(),n.ub(15,0,null,null,27,"div",[["class","flex-noshrink layout-row layout-align-end-center"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,ke)),n.tb(17,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.ub(18,0,null,null,0,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.ub(19,0,null,null,23,"div",[["class","flex-none layout-row layout-align-end-center"]],null,null,null,null,null)),(l()(),n.ub(20,0,null,null,1,"aggregates-toggle",[["class","flex-none hide show-gt-sm"]],null,null,null,ne,Yl)),n.tb(21,638976,null,0,Jl,[E.a,L.a,fl.a,A.a],{searchId:[0,"searchId"]},null),(l()(),n.ub(22,0,null,null,9,"button",[["class","cb-text-transform-none flex-none hide show-gt-sm"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(l,e,t){var n=!0;return"click"===e&&(n=!1!==l.component.showColumnPanel()&&n),n},i.d,i.b)),n.tb(23,180224,null,0,u.b,[n.k,s.f,[2,a.a]],{disabled:[0,"disabled"]},null),n.Ib(131072,r.b,[n.h]),n.Kb(25,1),(l()(),n.ub(26,0,null,0,5,"span",[["class","layout-row layout-align-start-center"]],null,null,null,null,null)),(l()(),n.ub(27,0,null,null,1,"icon",[["class","cb-margin-small-right"],["key","columns"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(28,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(29,0,null,null,2,"span",[],null,null,null,null,null)),(l()(),n.Ob(30,null,["",""])),n.Kb(31,1),(l()(),n.ub(32,0,null,null,8,"button",[["class","flex-none"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(l,e,t){var n=!0;return"click"===e&&(n=!1!==l.component.showTimelineClickHandler()&&n),n},i.d,i.b)),n.tb(33,180224,null,0,u.b,[n.k,s.f,[2,a.a]],null,null),n.Kb(34,1),(l()(),n.ub(35,0,null,0,5,"div",[["class","layout-row layout-align-center-center"]],null,null,null,null,null)),(l()(),n.ub(36,0,null,null,1,"icon",[["class","cb-margin-small-right flex-none"],["key","timeline"]],[[8,"className",0]],null,null,H.b,H.a)),n.tb(37,573440,null,0,z.a,[r.e,n.k],{key:[0,"key"],class:[1,"class"]},null),(l()(),n.ub(38,0,null,null,2,"span",[["class","flex"]],null,null,null,null,null)),(l()(),n.Ob(39,null,["",""])),n.Kb(40,1),(l()(),n.ub(41,0,null,null,1,"export-csv-button",[["class","flex-none hide show-gt-sm"]],null,null,null,ve,ge)),n.tb(42,114688,null,0,ue,[de,A.a,g.a,f.a,he.a],null,null),(l()(),n.ub(43,0,null,null,2,"div",[["class","cb-background-accent flex-none"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,Ce)),n.tb(45,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null),(l()(),n.ub(46,0,null,null,2,"div",[["class","flex layout-fill cb-relative cb-background-white"]],null,null,null,null,null)),(l()(),n.kb(16777216,null,null,1,null,De)),n.tb(48,16384,null,0,r.p,[n.P,n.L],{ngIf:[0,"ngIf"]},null)],function(l,e){var t=e.component;l(e,8,0,t.results,t.pageId,t.pageSize),l(e,11,0,!t.isStaticList),l(e,14,0,t.results,t.pageId,t.pageSize),l(e,17,0,t.showQuickAdd),l(e,21,0,t.search.id),l(e,23,0,n.Pb(e,23,0,n.Gb(e,24).transform(t.searchInProgress))),l(e,28,0,"columns","cb-margin-small-right"),l(e,37,0,"timeline","cb-margin-small-right flex-none"),l(e,42,0),l(e,45,0,t.selectedRows.size>0),l(e,48,0,t.columns&&t.columns.length>0)},function(l,e){var t=n.Pb(e,22,0,l(e,25,0,n.Gb(e,0),"CBL.SEARCH.COLUMNS.EDIT_COLUMNS"));l(e,22,0,t,n.Gb(e,23).disabled||null,"NoopAnimations"===n.Gb(e,23)._animationMode),l(e,27,0,n.Gb(e,28).classes);var i=n.Pb(e,30,0,l(e,31,0,n.Gb(e,0),"CBL.SEARCH.COLUMNS.COLUMNS"));l(e,30,0,i);var u=n.Pb(e,32,0,l(e,34,0,n.Gb(e,0),"CBL.TIMELINE.TIMELINE"));l(e,32,0,u,n.Gb(e,33).disabled||null,"NoopAnimations"===n.Gb(e,33)._animationMode),l(e,36,0,n.Gb(e,37).classes);var s=n.Pb(e,39,0,l(e,40,0,n.Gb(e,0),"CBL.TIMELINE.TIMELINE"));l(e,39,0,s)})}},"62RF":function(l,e,t){"use strict";t.d(e,"a",function(){return i}),t.d(e,"b",function(){return u});var n=t("Mlb/"),i=(t("szI2"),n.sb({encapsulation:2,styles:[],data:{}}));function u(l){return n.Qb(2,[n.Mb(402653184,1,{body:0}),(l()(),n.ub(1,0,[[1,0],["body",1]],null,2,"div",[["class","component--grid-body"]],null,null,null,null,null)),(l()(),n.ub(2,0,[["content",1]],null,1,"div",[["class","body-wrapper"]],null,null,null,null,null)),n.Fb(null,0)],null,null)}},AJGL:function(l,e,t){"use strict";t.d(e,"a",function(){return n});class n{constructor(l,e,t){this.platformService=l,this.ngZone=e,this.renderer=t,this.hasResizableColumns=!1,this.rowHeight=40,this.cellMinWidth=200,this.dragStartHandler=this.dragStart.bind(this),this.dragHandler=this.drag.bind(this),this.dragEndHandler=this.dragEnd.bind(this)}ngOnChanges(l){this.changes=l}ngAfterViewInit(){this.platformService.isBrowser()&&this.ngZone.runOutsideAngular(()=>{this.resizeGrid(),this.hasResizableColumns&&this.addResizeGrips()})}ngAfterViewChecked(){this.platformService.isBrowser()&&this.changes&&(this.changes&&this.changes.columns&&this.ngZone.runOutsideAngular(()=>{this.scrollToTop(),this.addResizeGrips()}),this.changes&&(this.changes.rows||this.changes.hasFooter)&&this.ngZone.runOutsideAngular(()=>{this.scrollToTop(),setTimeout(()=>this.resizeGrid())}),this.changes=void 0)}resizeGrid(){this.platformService.isBrowser()&&(this.isBodyOverflowing()?this.setScrollbarSpacing():this.unsetScrollbarSpacing())}scrollToTop(){this.body.scrollToTop()}setScrollbarSpacing(){let l=this.header.getElementRef().nativeElement;if(this.renderer.setStyle(l,"paddingRight",`${this.getScrollbarWidth()}px`),this.footer){let l=this.footer.getElementRef().nativeElement;this.renderer.setStyle(l,"paddingRight",`${this.getScrollbarWidth()}px`)}}unsetScrollbarSpacing(){let l=this.header.getElementRef().nativeElement;if(this.renderer.setStyle(l,"paddingRight",""),this.footer){let l=this.footer.getElementRef().nativeElement;this.renderer.setStyle(l,"paddingRight","")}}addResizeGrips(){let l=this.header.getElementRef().nativeElement.getElementsByTagName("grid-column-header");if(l&&l.length&&l.length>0)for(let e=0;e<l.length;e++){let t=l[e];if(!t.classList.contains("resizable")){this.renderer.addClass(t,"resizable");let l=t.dataset.columnid,e=this.renderer.createElement("div");this.renderer.addClass(e,"resize-grip"),this.renderer.setAttribute(e,"data-columnid",l),this.renderer.appendChild(t,e),this.platformService.isBrowser()&&e.addEventListener("mousedown",this.dragStartHandler)}}}dragStart(l){this.dragColumnId=l.target.dataset.columnid,this.dragGrip=l.target,this.dragColumnHeader=l.target.parentElement,this.initColStyleEls(),this.dragStyleEl=this.getColStyleEl(this.dragColumnId),this.renderer.addClass(this.dragGrip,"active"),document.addEventListener("mousemove",this.dragHandler),document.addEventListener("mouseup",this.dragEndHandler)}drag(l){let e=this.dragColumnHeader.getBoundingClientRect();this.setColumnSizeStyle(this.dragStyleEl,this.dragColumnId,e.width+(l.clientX-e.right)),this.unFocus()}dragEnd(l){this.renderer.removeClass(this.dragGrip,"active"),this.dragColumnId=void 0,this.dragGrip=void 0,this.dragColumnHeader=void 0,this.dragStyleEl=void 0,document.removeEventListener("mousemove",this.dragHandler),document.removeEventListener("mouseup",this.dragEndHandler),this.unFocus()}unFocus(){window.getSelection().removeAllRanges()}initColStyleEls(){let l=this.header.getElementRef().nativeElement.getElementsByTagName("grid-column-header"),e=[];if(l&&l.length&&l.length>0)for(let t=0;t<l.length;t++){let n=l[t],i=n.dataset.columnid,u=this.getColStyleEl(i);u||(u=this.createColStyleEl(i));let s=n.getBoundingClientRect().width;e.push({columnId:i,width:s,styleEl:u})}if(e.length>1)for(let t=0;t<e.length;t++){let l=e[t];this.setColumnSizeStyle(l.styleEl,l.columnId,l.width)}}setColumnSizeStyle(l,e,t){let n=this.getGridSelector(),i=this.getColumnSelector(e);t<this.cellMinWidth&&(t=this.cellMinWidth),this.renderer.setProperty(l,"innerHTML",`.${n} .${i} {\n            flex-basis: ${t}px !important;\n            min-width: ${t}px !important;\n        }`)}getColStyleEl(l){let e=this.getStyleElId(l);return document.getElementById(e)}createColStyleEl(l){let e=this.getColStyleEl(l);if(!e){let t=this.getStyleElId(l);e=this.renderer.createElement("style"),this.renderer.setAttribute(e,"id",t),document.body.appendChild(e)}return e}getStyleElId(l){return`${this.getGridSelector()}-${this.getColumnSelector(l)}`}getGridSelector(){return`grid-id-${this.gridId}`}getColumnSelector(l){return`column-id-${l}`}getScrollbarWidth(){if("number"==typeof this.scrollbarWidth)return this.scrollbarWidth;let l=this.renderer.createElement("div");this.renderer.setStyle(l,"visibility","hidden"),this.renderer.setStyle(l,"width","100px"),this.renderer.setStyle(l,"overflow","scroll"),this.renderer.setStyle(l,"msOverflowStyle","scrollbar");let e=this.renderer.createElement("div");return this.renderer.setStyle(e,"width","100%"),this.renderer.appendChild(l,e),this.renderer.appendChild(this.gridViewport.nativeElement,l),this.scrollbarWidth=l.offsetWidth-e.offsetWidth,this.renderer.removeChild(this.gridViewport.nativeElement,l),this.scrollbarWidth}isBodyOverflowing(){let l=this.body.getElementRef().nativeElement;return l.scrollHeight>l.clientHeight}}},BVFw:function(l,e,t){"use strict";t.d(e,"a",function(){return a}),t.d(e,"b",function(){return r});var n=t("Mlb/"),i=t("vk2e"),u=t("D8se"),s=t("pees"),a=(t("AJGL"),n.sb({encapsulation:2,styles:[],data:{}}));function r(l){return n.Qb(2,[n.Mb(402653184,1,{gridViewport:0}),(l()(),n.ub(1,0,[[1,0],["gridViewport",1]],null,5,"div",[["class","component--sheet-grid"],["regulateExecutionBy","throttle"],["wait","16"],["windowResizeNotifier",""]],null,[[null,"onResize"]],function(l,e,t){var n=!0;return"onResize"===e&&(n=!1!==l.component.resizeGrid()&&n),n},null,null)),n.Lb(512,null,i.F,i.G,[n.r,n.s,n.k,n.D]),n.tb(3,278528,null,0,i.n,[i.F],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),n.tb(4,1196032,null,0,u.a,[s.a,n.y],{regulateExecutionBy:[0,"regulateExecutionBy"],wait:[1,"wait"]},{onResize:"onResize"}),(l()(),n.ub(5,0,[["gridContainer",1]],null,1,"div",[["class","grid-container"]],null,null,null,null,null)),n.Fb(null,0)],function(l,e){l(e,3,0,"component--sheet-grid","grid-id-"+e.component.gridId),l(e,4,0,"throttle","16")},null)}},DJAz:function(l,e,t){"use strict";t.d(e,"a",function(){return n});class n{getElementRef(){return this.header}}},J85h:function(l,e,t){"use strict";t.d(e,"a",function(){return n});class n{}},NFli:function(l,e,t){"use strict";t.d(e,"a",function(){return n});class n{constructor(l,e){this.elementRef=l,this.renderer=e}ngAfterViewInit(){this.columnId&&(this.renderer.addClass(this.elementRef.nativeElement,`column-id-${this.columnId}`),this.renderer.setAttribute(this.elementRef.nativeElement,"data-columnid",this.columnId))}}},aMtI:function(l,e,t){"use strict";t.d(e,"a",function(){return o});var n=t("9va6"),i=t("EYJY"),u=t("ccoi"),s=t("Mlb/"),a=t("ue+9"),r=t("rILe");let o=(()=>{class l{constructor(l,e,t,n,u,a,r,o,c,b,d,h){this.labelService=l,this.dialogService=e,this.searchStateService=t,this.searchResultService=n,this.searchUpsellService=u,this.permService=a,this.progressService=r,this.metadataService=o,this.route=c,this.toastService=b,this.util=d,this.logService=h,this.searchHandler=new s.m,this.showTimelineHandler=new s.m,this.columns=[],this.rows=[],this.selectedRows=new Map,this.currentPage=1,this.pageSize=50,this.showAllResultsUpsell=!1,this.showForbiddenUpsell=!1,this.blurredRows=[],this.onDestroy=new i.a}ngOnInit(){this.logger=this.logService.getLogger("ResultsComponent"),this.isStaticList=this.getIsStaticList(),this.searchResultService.getSearchResultsObservable().pipe(Object(u.a)(this.onDestroy)).subscribe(l=>{this.setupParamsSubscription(),this.handleResultsChanged(l)}),this.searchInProgress=this.searchResultService.getSearchInProgressObservable(),this.searchInProgress.pipe(Object(u.a)(this.onDestroy)).subscribe(l=>{l&&(this.rows=[])}),this.currentPage=this.searchResultService.parsePageId(this.pageId).page,this.pageSize=this.searchResultService.getPageSize();let l=this.searchResultService.getResult(this.pageId);l?(this.handleResultsChanged(l),this.setupParamsSubscription()):this.searchResultService.search(this.pageId);const e=this.search.getList();this.showQuickAdd=e&&e.list_type===a.D.ListTypeEnum.static&&e.is_owner}ngOnChanges(l){if(l.search&&l.search.previousValue){let{currentValue:e,previousValue:t}=l.search;t.collectionId!==e.collectionId&&(this.selectedRows.clear(),this.columns=this.getColumns(e.collectionId,e.getColumns()),this.showQuickAdd&&this.quickAdd.clearInput())}if(l.pageId){let{currentValue:e,previousValue:t,firstChange:n}=l.pageId;!e&&!t||e===t||(this.currentPage=this.searchResultService.parsePageId(e).page,n||this.searchResultService.search(e))}this.setup()}ngOnDestroy(){this.onDestroy.next(),this.dialogService.closeAllDialogs()}handleRemove(){this.searchResultService.search(this.pageId,!0),this.selectedRows.clear()}searchClickHandler(){this.searchHandler.emit()}showTimelineClickHandler(){this.showTimelineHandler.emit()}shouldShowStatistics(){return this.searchStateService.getFieldAggregators().length>0}selectAll(){this.progressService.startProgress(l.PROGRESS_KEY),this.searchResultService.getFullSearchResults().toPromise().then(this.handleSelectAllResults.bind(this),()=>{this.toastService.showSimpleToast("CBL.COMMON.FAILURE"),this.selectIsCapped=!1}).then(()=>{this.progressService.stopProgress(l.PROGRESS_KEY)})}deselectAll(){this.selectedRows.clear(),this.selectIsCapped=!1}selectPage(){this.rows.forEach(l=>{this.selectedRows.set(l.properties.identifier.uuid,l)})}deselectPage(){this.rows.forEach(l=>{this.selectedRows.delete(l.properties.identifier.uuid)}),this.selectIsCapped=!1}setIsSelected(l,e){l?this.selectedRows.set(e.properties.identifier.uuid,e):(this.selectIsCapped=!1,this.selectedRows.delete(e.properties.identifier.uuid))}isRowSelected(l){return!(!l||!l.properties||!this.selectedRows.get(l.properties.identifier.uuid))}trackByColumnId(l,e){return e?this.collectionId+" "+e.id:void 0}trackByRow(l,e){return e?e.properties.identifier.uuid:void 0}setSort(l){l.direction!==a.F.SortEnum.asc&&l.direction!==a.F.SortEnum.desc||(this.searchStateService.setOrder(l.columnId,l.direction),this.searchResultService.search(this.pageId))}removeSort(l){this.searchStateService.removeOrder(),this.searchResultService.search(this.pageId)}removeColumn(l){let e=this.columns.map(l=>l.id),t=this.searchStateService.getOrder(),i=Object(n.indexOf)(e,l);if(i>-1){this.columns.splice(i,1),this.searchStateService.unselectColumn(l);let e=this.searchStateService.getOrder();Object(n.isEqual)(t,e)||this.searchResultService.search(this.pageId)}}moveColumn(l){let e=this.columns.map(l=>l.id),t=e.indexOf(l.columnId),n=-1;if("start"===l.location?n=0:"left"===l.location?n=t-1:"end"===l.location?n=e.length-1:"right"===l.location&&(n=t+1),t>-1&&n>-1&&t!==n){let l=this.columns.splice(t,1)[0];this.columns.splice(n,0,l);let e=this.columns.map(l=>l.id);this.searchStateService.setSelectedColumns(e)}}showColumnPanel(){let l={title:this.labelService.getLabel("CBL.SEARCH.COLUMNS.EDIT_COLUMNS"),searchId:this.search.id};this.dialogService.showDialog(r.a,l)}setupParamsSubscription(){this.paramsSubscription||(this.paramsSubscription=this.route.params.pipe(Object(u.a)(this.onDestroy)).subscribe(()=>{this.triggerAutomaticSearch()}))}triggerAutomaticSearch(){this.searchResultService.search(this.pageId)}setup(){this.updateSort();let{collectionId:l}=this.searchStateService.getSearchInfo();this.collectionId=l}handleResultsChanged(l){this.results=l;let e=this.searchResultService.getSearchError();this.forbiddenResults=e&&e.isForbidden(),this.setUpsell(l);let t=this.searchStateService.getSelectedColumns()||[],{collectionId:n}=this.searchStateService.getSearchInfo();this.collectionId=n,this.columns=this.getColumns(n,t),this.updateSort(),this.updateResults(l)}handleSelectAllResults(l){let e=l.data.entities;this.selectIsCapped=l.data.count>e.length&&!this.permService.hasNerfedSearchResultLimit(),this.selectedRows.clear(),e.forEach(l=>{this.selectedRows.set(l.properties.identifier.uuid,l)})}updateResults(l){let e=[];l&&l.entities?e=l.entities:this.logger.error("Attempted to update results with invalid results data",{results:l}),this.rows=e,this.aggregates=l&&l.aggregates?l.aggregates:{}}getColumns(l,e){let t=this.metadataService.getSortableFieldTypeIds(),i=[];return Object(n.forEach)(e,e=>{let u=this.metadataService.getField(l,e);if(!this.util.isUndefinedOrNull(u)){let l=Object(n.cloneDeep)(u);l.isSortable=t.indexOf(l.type_id)>-1,l.sortUpsell=this.permService.canOrderByField()?null:"column_sort",l.facet_id&&(l.facet=this.metadataService.getFacet(this.collectionId,l.facet_id)),l.theme=this.metadataService.getFieldTheme(this.collectionId,u.id),i.push(l)}}),i}updateSort(){let l=this.searchStateService.getOrder();this.order=l&&l.length>0?l[0]:null}getIsStaticList(){const l=this.search.getList();return!(!l||l.list_type!==a.D.ListTypeEnum.static)}setUpsell(l){const e=this.searchUpsellService.getFeatureSetForPage(this.currentPage),t="results"===e;this.blurredRows=l&&l.hiddenEntities||[],this.showAllResultsUpsell=t&&this.blurredRows.length>0,this.showForbiddenUpsell="forbidden"===e;const n=this.metadataService.getEntityDef(this.search.collectionId);this.upsellHeadLineTextContext={totalResultsCount:l.labels&&l.labels.displayTotalResultCount||"",pluralEntityDefLabel:(n&&n.labels&&n.labels.plural).toLowerCase()}}}return l.PROGRESS_KEY="RESULTS",l})()},gb1R:function(l,e,t){"use strict";t.d(e,"a",function(){return i});var n=t("Mlb/");let i=(()=>{class l{constructor(){}downloadCSVData(e,t,n){let i=e+".csv",u=[this.getCsvData(t,n)],s=new Blob(u,{type:l.CSV_DATATYPE});if(navigator.msSaveBlob)return void navigator.msSaveBlob(s,i);let a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.setAttribute("download",i),document.body.appendChild(a),a.click(),document.body.removeChild(a)}getCsvData(l,e){let t=this,n="";return l&&e?(n+=l.join(",")+"\n",e.forEach(function(e){n+=l.map(function(l){return t.escape(e[l])}).join(",")+"\n"}),n):n}escape(l){return((l=(l=(l=l||"").replace(/["]/g,'""')).replace(/[\n\r]+/g," ")).indexOf(",")>0||l.indexOf('"')>0)&&(l=['"',l,'"'].join("")),l}}return l.CSV_DATATYPE="text/csv;charset=utf-8;",l.ngInjectableDef=n.Ub({factory:function(){return new l},token:l,providedIn:"root"}),l})()},szI2:function(l,e,t){"use strict";t.d(e,"a",function(){return n});class n{getElementRef(){return this.body}scrollToTop(){this.body.nativeElement.scrollTop=0}}},"xJk/":function(l,e,t){"use strict";t.d(e,"a",function(){return i}),t.d(e,"b",function(){return u});var n=t("Mlb/"),i=(t("DJAz"),n.sb({encapsulation:2,styles:[],data:{}}));function u(l){return n.Qb(2,[n.Mb(402653184,1,{header:0}),(l()(),n.ub(1,0,[[1,0],["header",1]],null,1,"div",[["class","component--grid-header"]],null,null,null,null,null)),n.Fb(null,0)],null,null)}},"y6+A":function(l,e,t){"use strict";t.d(e,"a",function(){return u}),t.d(e,"b",function(){return s});var n=t("Mlb/"),i=t("vk2e"),u=(t("NFli"),n.sb({encapsulation:2,styles:[],data:{}}));function s(l){return n.Qb(2,[(l()(),n.ub(0,0,null,null,4,"div",[["class","component--grid-cell grid-cell"]],null,null,null,null,null)),(l()(),n.ub(1,0,null,null,3,"div",[["class","cb-absolute-to-cover layout-row"]],null,null,null,null,null)),n.Lb(512,null,i.F,i.G,[n.r,n.s,n.k,n.D]),n.tb(3,278528,null,0,i.n,[i.F],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),n.Fb(null,0)],function(l,e){l(e,3,0,"cb-absolute-to-cover layout-row","select"===e.component.columnId?"layout-align-center-center":"layout-align-start-center")},null)}},ykfZ:function(l,e,t){"use strict";t.d(e,"a",function(){return i}),t.d(e,"b",function(){return u});var n=t("Mlb/"),i=(t("J85h"),n.sb({encapsulation:2,styles:[],data:{}}));function u(l){return n.Qb(2,[(l()(),n.ub(0,0,[["row",1]],null,1,"div",[["class","component--grid-row"]],null,null,null,null,null)),n.Fb(null,0)],null,null)}}}]);